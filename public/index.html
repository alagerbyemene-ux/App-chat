ذ<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> شات رعووود الحياه </title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- شاشة تسجيل الدخول -->
    <div id="loginScreen" class="screen active">
        <div class="login-container">
            <div class="login-header">
                <div class="logo">
                    <h1> شات رعووود الحياه </h1>
                    <p>منصة التواصل الاجتماعي الأولى</p>
                </div>
            </div>
            <div class="login-tabs">
                <button class="tab-btn active" onclick="showLoginTab('login')">
                    <i class="fas fa-sign-in-alt"></i>
                    تسجيل الدخول
                </button>
                <button class="tab-btn" onclick="showLoginTab('register')">
                    <i class="fas fa-user-plus"></i>
                    إنشاء حساب
                </button>
                <button class="tab-btn" onclick="showLoginTab('guest')">
                    <i class="fas fa-user-secret"></i>
                    دخول كزائر
                </button>
            </div>
            <!-- تسجيل الدخول -->
            <form id="loginForm" class="auth-form active">
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <input type="email" id="loginEmail" placeholder="البريد الإلكتروني" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="loginPassword" placeholder="كلمة المرور" required>
                </div>
                <button type="submit" class="auth-btn">
                    <i class="fas fa-sign-in-alt"></i>
                    دخول
                </button>
            </form>
            <!-- إنشاء حساب -->
            <form id="registerForm" class="auth-form">
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <input type="text" id="registerDisplayName" placeholder="الاسم المعروض" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <input type="email" id="registerEmail" placeholder="البريد الإلكتروني" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="registerPassword" placeholder="كلمة المرور" required>
                </div>
                <button type="submit" class="auth-btn">
                    <i class="fas fa-user-plus"></i>
                    إنشاء حساب
                </button>
            </form>
            <!-- دخول كزائر -->
            <form id="guestForm" class="auth-form">
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <input type="text" id="guestName" placeholder="الاسم المستخدم" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-birthday-cake"></i>
                    <input type="number" id="guestAge" placeholder="العمر" min="13" max="99" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-venus-mars"></i>
                    <select id="guestGender" required>
                        <option value="">اختر الجنس</option>
                        <option value="ذكر">ذكر</option>
                        <option value="أنثى">أنثى</option>
                        <option value="آخر">آخر</option>
                    </select>
                </div>
                <button type="submit" class="auth-btn">
                    <i class="fas fa-user-secret"></i>
                    دخول كزائر
                </button>
            </form>
            <div id="loginError" class="error-message"></div>
        </div>
    </div>
    <
    <!-- الشاشة الرئيسية -->
    <div id="mainScreen" class="screen">
        <!-- الشريط العلوي -->
        <header class="main-header">
            <div class="header-left">
                <button class="hamburger-btn" onclick="openMainMenu()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="app-logo">
                    <h1>شات رعووود الحياه </h1>
                </div>
            </div>
        <!-- ⬇⬇⬇ استبدال القائمة المنسدلة بزر جديد في الشريط العلوي ⬇⬇⬇ -->
        <div class="header-center">
            <!-- لا نضع أي زر هنا، سنضيفه في الشريط السفلي فقط -->
            <h2 id="currentRoomName">الغرفة الرئيسية</h2> <!-- نحتفظ باسم الغرفة في الوسط -->
        </div>
        <!-- ⬆⬆⬆ نهاية التعديل ⬆⬆⬆ -->
        <div class="header-right">
            <!-- ⬇⬇⬇ زر الرسائل الخاصة ⬇⬇⬇ -->
            <button class="header-btn" onclick="openMessages()" title="رسالة">
                <i class="fas fa-envelope"></i>
                <span id="messagesCount" class="notification-badge">0</span>
            </button>

            <!-- ⬇⬇⬇ زر طلبات الصداقة ⬇⬇⬇ -->
            <div style="position: relative;">
                <button class="header-btn" onclick="toggleFriendRequests()" title="طلب">
                    <i class="fas fa-user-plus"></i>
                    <span id="friendRequestsCount" class="notification-badge" style="display: none;">0</span>
                </button>

                <!-- قائمة طلبات الصداقة المنسدلة -->
                <div id="friendRequestsDropdown" class="friend-requests-dropdown">
                    <div class="dropdown-header">
                        <h4>طلبات الصداقة</h4>
                    </div>
                    <div id="friendRequestsList" class="friend-requests-list">
                        <!-- سيتم ملؤها بالجافاسكريبت -->
                    </div>
                </div>
            </div>

            <style>
            /* القائمة المنسدلة */
            .friend-requests-dropdown {
                position: absolute;
                top: 50px;
                right: 0;
                width: 320px;
                max-height: 450px;
                background: #fff;
                border-radius: 10px;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
                z-index: 9999;
                display: none;
                overflow: hidden;
            }

            .friend-requests-dropdown.active {
                display: block;
                animation: slideDown 0.3s ease;
            }

            @keyframes slideDown {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .dropdown-header {
                padding: 15px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #fff;
                border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            }

            .dropdown-header h4 {
                margin: 0;
                font-size: 16px;
                font-weight: 600;
            }

            .friend-requests-list {
                max-height: 380px;
                overflow-y: auto;
            }

            .friend-request-item {
                display: flex;
                align-items: center;
                gap: 10px;
                padding: 12px 15px;
                border-bottom: 1px solid #f0f0f0;
                transition: all 0.3s;
            }

            .friend-request-item:last-child {
                border-bottom: none;
            }

            .friend-request-item:hover {
                background: #f8f9fa;
            }

            .request-avatar {
                width: 45px;
                height: 45px;
                border-radius: 50%;
                object-fit: cover;
                border: 2px solid #667eea;
            }

            .request-info {
                flex: 1;
                min-width: 0;
            }

            .request-name {
                font-size: 14px;
                font-weight: 600;
                color: #333;
                margin-bottom: 2px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .request-time {
                font-size: 11px;
                color: #999;
            }

            .request-actions {
                display: flex;
                gap: 5px;
            }

            .accept-btn, .reject-btn {
                padding: 6px 12px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 12px;
                font-weight: 500;
                transition: all 0.3s;
            }

            .accept-btn {
                background: #4CAF50;
                color: #fff;
            }

            .accept-btn:hover {
                background: #45a049;
                transform: scale(1.05);
            }

            .reject-btn {
                background: #f44336;
                color: #fff;
            }

            .reject-btn:hover {
                background: #da190b;
                transform: scale(1.05);
            }

            .no-requests {
                text-align: center;
                padding: 40px 20px;
                color: #999;
            }

            .no-requests i {
                font-size: 40px;
                margin-bottom: 10px;
                color: #ddd;
            }

            .no-requests p {
                font-size: 14px;
                margin: 0;
            }

            /* شارة الإشعارات */
            .notification-badge {
                position: absolute;
                top: -5px;
                right: -5px;
                background: #ff4444;
                color: #fff;
                border-radius: 50%;
                width: 20px;
                height: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 11px;
                font-weight: bold;
            }
            </style>

            <script>
            // قائمة طلبات الصداقة
            let friendRequests = [];

            // فتح/إغلاق القائمة المنسدلة
            function toggleFriendRequests() {
                const dropdown = document.getElementById('friendRequestsDropdown');
                dropdown.classList.toggle('active');
                updateFriendRequestsList();
            }

            // تحديث قائمة طلبات الصداقة
            function updateFriendRequestsList() {
                const listContainer = document.getElementById('friendRequestsList');
                const countBadge = document.getElementById('friendRequestsCount');

                if (friendRequests.length === 0) {
                    listContainer.innerHTML = `
                        <div class="no-requests">
                            <i class="fas fa-user-friends"></i>
                            <p>لا توجد طلبات صداقة</p>
                        </div>
                    `;
                    countBadge.style.display = 'none';
                } else {
                    countBadge.style.display = 'flex';
                    countBadge.textContent = friendRequests.length;

                    listContainer.innerHTML = friendRequests.map((request) => `
                        <div class="friend-request-item">
                            <img src="${request.avatar || 'https://via.placeholder.com/45'}" alt="${request.name}" class="request-avatar">
                            <div class="request-info">
                                <div class="request-name">${request.name}</div>
                                <div class="request-time">${request.time}</div>
                            </div>
                            <div class="request-actions">
                                <button class="accept-btn" onclick="acceptFriendRequest('${request.userId}')">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="reject-btn" onclick="rejectFriendRequest('${request.userId}')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    `).join('');
                }
            }

            // قبول طلب الصداقة
            function acceptFriendRequest(userId) {
                socket.emit('acceptFriendRequest', { userId: userId });
            }

            // رفض طلب الصداقة
            function rejectFriendRequest(userId) {
                socket.emit('rejectFriendRequest', { userId: userId });
            }

            // إرسال طلب صداقة
            function sendFriendRequest(targetUserId) {
                socket.emit('sendFriendRequest', { targetUserId: targetUserId });
            }

            // ====== استقبال الأحداث من السيرفر ======

            // عند استقبال طلب صداقة جديد
            socket.on('newFriendRequest', (data) => {
                friendRequests.push({
                    userId: data.userId,
                    name: data.userName,
                    avatar: data.userAvatar,
                    time: 'الآن'
                });
                updateFriendRequestsList();
                showNotification(`طلب صداقة جديد من ${data.userName}`, 'info');
            });

            // عند قبول طلب الصداقة
            socket.on('friendRequestAccepted', (data) => {
                friendRequests = friendRequests.filter(req => req.userId !== data.userId);
                updateFriendRequestsList();
                showNotification(`تم قبول طلب الصداقة من ${data.userName}`, 'success');
            });

            // عند رفض طلب الصداقة
            socket.on('friendRequestRejected', (data) => {
                friendRequests = friendRequests.filter(req => req.userId !== data.userId);
                updateFriendRequestsList();
            });

            // عند إرسال طلب صداقة بنجاح
            socket.on('friendRequestSent', (data) => {
                showNotification('تم إرسال طلب الصداقة بنجاح', 'success');
            });

            // عند وجود خطأ
            socket.on('friendRequestError', (data) => {
                showNotification(data.message, 'error');
            });

            // تحميل طلبات الصداقة عند الاتصال
            socket.on('loadFriendRequests', (data) => {
                friendRequests = data.requests || [];
                updateFriendRequestsList();
            });

            // إغلاق القائمة عند الضغط خارجها
            document.addEventListener('click', function(event) {
                const dropdown = document.getElementById('friendRequestsDropdown');
                const btn = event.target.closest('.header-btn[title="طلب"]');

                if (dropdown && !dropdown.contains(event.target) && !btn) {
                    dropdown.classList.remove('active');
                }
            });

            // دالة إظهار الإشعارات
            function showNotification(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                toast.textContent = message;
                toast.style.cssText = `
                    position: fixed;
                    top: 80px;
                    right: 20px;
                    background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3'};
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    z-index: 99999;
                    font-size: 14px;
                    animation: slideInRight 0.3s ease;
                `;
                document.body.appendChild(toast);

                setTimeout(() => {
                    toast.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }
            </script>

            <button class="header-btn" onclick="openNotifications()" title="الإشعارات">
                <i class="fas fa-bell"></i>
                <span id="notificationCount" class="notification-badge">0</span>
            </button>
            <button class="header-btn" onclick="openSettings()" title="الإعدادات">
                <i class="fas fa-cog"></i>
            </button>
            <div class="user-profile-mini" onclick="openProfileModal()">
                <img id="headerUserAvatar" class="user-avatar-mini" src="https://images.pexels.com/photos/771742/pexels-photo-771742.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&fit=crop" alt="">
                <div class="user-info-mini">
                    <span id="headerUserName" class="user-name">المستخدم</span>
                    <span id="headerUserRank" class="user-rank">زائر</span>
                </div>
            </div>
        </div>
        </header>
        <!-- المحتوى الرئيسي -->
        <main class="main-content">
            <!-- منطقة الدردشة -->
            <div class="chat-area">
                <div class="chat-header">
                    <h2 id="currentRoomName">الغرفة الرئيسية</h2>
                    <div class="chat-controls">
                        <button class="control-btn" onclick="toggleChatMode()" title="تبديل وضع الدردشة">
                            <i class="fas fa-exchange-alt"></i>
                            <span id="chatModeText">عام</span>
                        </button>
                        <button class="control-btn" onclick="clearChat()" title="مسح الدردشة" id="clearChatBtn" style="display: none;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div id="messagesContainer" class="messages-container">
                    <div class="welcome-message">
                        <div class="welcome-content">
                            <h3>  مرحباً بك في شات رعووود الحياه </h3>ال
                            <p>ابدأ محادثة جديدة أو انضم للمحادثات الجارية</p>
                        </div>
                    </div>
                </div>
                <div class="message-input-container">
                    <div class="input-tools">
                        <button class="tool-btn" onclick="document.getElementById('imageInput').click()" title="إرسال صورة">
                            <i class="fas fa-image"></i>
                        </button>
                        <button class="tool-btn" onclick="toggleVoiceRecording()" title="تسجيل صوتي" id="voiceBtn">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button class="tool-btn" onclick="openEmojiPicker()" title="الرموز التعبيرية">
                            <i class="fas fa-smile"></i>
                        </button>
                        <button class="tool-btn" onclick="openGifPicker()" title="صور متحركة">
                            <i class="fas fa-magic"></i>
                        </button>
                    </div>
                    <div class="message-input-wrapper">
                        <div class="quoted-message" id="quotedMessage" style="display: none;">
                            <div class="quoted-content">
                                <span class="quoted-author"></span>
                                <span class="quoted-text"></span>
                            </div>
                            <button class="cancel-quote" onclick="cancelQuote()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <input type="text" id="messageInput" placeholder="اكتب رسالتك هنا..." maxlength="80">
                        <button class="send-btn" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    <input type="file" id="imageInput" accept="image/*" style="display: none;">
                    <input type="file" id="voiceInput" accept="audio/*" style="display: none;">
                </div>
            </div>
            
        <!-- ⬇⬇⬇ نافذة الغرف الجانبية (الجديدة) ⬇⬇⬇ -->
        <div id="roomsSidebar" class="rooms-sidebar">
            <div class="sidebar-header">
                <h3>الغرف المتاحة</h3>
                <button class="close-btn" onclick="toggleRoomsSidebar()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="roomsList" class="rooms-list">
                <!-- سيتم ملؤها بالجافاسكريبت -->
            </div>
        </div>
        <!-- ⬇⬇⬇ نافذة المتواجدين الجانبية ⬇⬇⬇ -->
        <div id="onlineUsersSidebar" class="rooms-sidebar">
            <div class="rooms-header">
                <h2><i class="fas fa-users"></i> المتواجدين حالياً</h2>
                <button class="close-rooms-btn" onclick="toggleOnlineUsersSidebar()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="rooms-list" id="onlineUsersList">
                <p style="text-align: center; color: var(--text-secondary);">جاري تحميل قائمة المتصلين...</p>
            </div>
        </div>
        <!-- ⬆⬆⬆ نهاية نافذة المتواجدين الجانبية ⬆⬆⬆ -->

            <!-- شريط التحكم السفلي -->
            <div class="bottom-control-bar">
                <!-- ⬇⬇⬇ زر المتواجدين (أول زر في الشريط) ⬇⬇⬇ -->
                <button class="control-btn" onclick="toggleOnlineUsersSidebar()" title="المتواجدين">
                    <i class="fas fa-users"></i>
                </button>
                <!-- ⬆⬆⬆ نهاية زر المتواجدين ⬆⬆⬆ -->

                <!-- ⬇⬇⬇ زر الغرف (ثاني زر في الشريط) ⬇⬇⬇ -->
                <button class="control-btn" onclick="toggleRoomsSidebar()" title="الغرف">
                    <i class="fas fa-home"></i>
                </button>
                <!-- ⬆⬆⬆ نهاية زر الغرف ⬆⬆⬆ -->

                <button class="control-btn" onclick="reloadPage()" title="تحديث الصفحة">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="control-btn" onclick="openRadioPlayer()" title="الراديو">
                    <i class="fas fa-radio"></i>
                </button>
                <div class="music-controls">
                    <button class="control-btn" onclick="toggleMusicPlayer()" title="مشغل الموسيقى" id="musicToggle">
                        <i class="fas fa-music"></i>
                    </button>
                    <div class="volume-control">
                        <i class="fas fa-volume-up"></i>
                        <input type="range" id="volumeSlider" min="0" max="100" value="50">
                    </div>
                </div>
                <div class="now-playing" id="nowPlaying" style="display: none;">
                    <span class="song-title">لا يوجد تشغيل</span>
                </div>
            </div>

            <style>
            /* ⬇⬇⬇ شريط نحيف ومثبت تحت شريط الكتابة ⬇⬇⬇ */
            .bottom-control-bar {
                z-index: 10000 !important;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                width: 100%;
                background: linear-gradient(180deg, rgba(69, 90, 100, 0.98) 0%, rgba(55, 71, 79, 0.95) 100%);
                backdrop-filter: blur(10px);
                border-top: 1px solid rgba(255, 255, 255, 0.1);
                padding: 8px 20px;
                display: flex; /* يظهر دائماً */
                align-items: center;
                justify-content: center;
                gap: 15px;
                box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
                height: 60px;
            }

            /* ⬇⬇⬇ إخفاء الشريط في صفحة تسجيل الدخول فقط ⬇⬇⬇ */
            body[data-page="login"] .bottom-control-bar {
                display: none !important;
            }

            /* ⬇⬇⬇ أزرار دائرية نحيفة ⬇⬇⬇ */
            .control-btn {
                width: 42px;
                height: 42px;
                min-width: 42px;
                border-radius: 50%;
                border: none;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
                box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
                flex-shrink: 0;
            }

            .control-btn:hover {
                transform: translateY(-3px) scale(1.08);
                box-shadow: 0 5px 15px rgba(102, 126, 234, 0.5);
            }

            .control-btn:active {
                transform: translateY(0) scale(0.95);
            }

            .control-btn i {
                font-size: 18px;
            }

            /* ⬇⬇⬇ التحكم بالصوت نحيف ⬇⬇⬇ */
            .music-controls {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .volume-control {
                display: flex;
                align-items: center;
                gap: 8px;
                background: rgba(255, 255, 255, 0.1);
                padding: 6px 12px;
                border-radius: 25px;
                height: 36px;
            }

            .volume-control i {
                color: white;
                font-size: 16px;
            }

            #volumeSlider {
                width: 80px;
                height: 4px;
                cursor: pointer;
                accent-color: #667eea;
            }

            /* ⬇⬇⬇ النص الصغير للأغنية ⬇⬇⬇ */
            .now-playing {
                font-size: 12px;
                color: rgba(255, 255, 255, 0.9);
                max-width: 130px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                font-weight: 500;
            }

            /* ⬇⬇⬇ رفع منطقة الكتابة للأعلى ⬇⬇⬇ */
            .message-input-container,
            .chat-input-wrapper,
            form.message-form,
            .input-area {
                padding-bottom: 70px !important;
            }

            /* ⬇⬇⬇ القائمة الجانبية تحت الأزرار ⬇⬇⬇ */
            .rooms-sidebar,
            #onlineUsersSidebar {
                z-index: 9999 !important;
                position: fixed;
                top: 0;
                right: -100%;
                width: 350px;
                height: 100vh;
                padding-bottom: 80px;
                background: white;
                transition: right 0.3s ease;
                overflow-y: auto;
                box-shadow: -3px 0 15px rgba(0, 0, 0, 0.2);
            }

            .rooms-sidebar.active,
            #onlineUsersSidebar.active {
                right: 0;
            }
            </style>

            <script>
            // ⬇⬇⬇ تحديد نوع الصفحة بناءً على URL ⬇⬇⬇
            function detectPageType() {
                const url = window.location.href;
                const path = window.location.pathname;

                // إذا الرابط فيه "login" أو "signin" = صفحة تسجيل دخول
                if (url.includes('login') || url.includes('signin') || path.includes('login')) {
                    document.body.setAttribute('data-page', 'login');
                } else {
                    document.body.setAttribute('data-page', 'chat');
                }
            }

            // تشغيل عند تحميل الصفحة
            detectPageType();

            // إعادة التحقق عند تغيير الرابط
            window.addEventListener('popstate', detectPageType);
            window.addEventListener('hashchange', detectPageType);

            // ⬇⬇⬇ دالة فتح/إغلاق نافذة المتواجدين ⬇⬇⬇
            function toggleOnlineUsersSidebar() {
                const sidebar = document.getElementById('onlineUsersSidebar');
                const roomsSidebar = document.getElementById('roomsSidebar');

                if (roomsSidebar && roomsSidebar.classList.contains('active')) {
                    roomsSidebar.classList.remove('active');
                }

                if (sidebar) {
                    sidebar.classList.toggle('active');

                    if (sidebar.classList.contains('active')) {
                        loadOnlineUsers();
                    }
                }
            }

            // ⬇⬇⬇ دالة تحميل قائمة المتواجدين ⬇⬇⬇
            function loadOnlineUsers() {
                const onlineUsers = [];

                const listContainer = document.getElementById('onlineUsersList');
                if (!listContainer) return;

                listContainer.innerHTML = '';

                if (onlineUsers.length === 0) {
                    listContainer.innerHTML = `
                        <div style="text-align: center; padding: 50px 20px; color: #999;">
                            <i class="fas fa-users" style="font-size: 50px; margin-bottom: 20px; opacity: 0.3;"></i>
                            <p style="font-size: 16px;">لا يوجد متواجدين حالياً</p>
                        </div>
                    `;
                    return;
                }

                onlineUsers.forEach(user => {
                    const userItem = document.createElement('div');
                    userItem.className = 'room-item';
                    userItem.innerHTML = `
                        <div class="room-avatar">${user.avatar}</div>
                        <div class="room-info">
                            <div class="room-name">${user.name}</div>
                            <div class="room-members">
                                <i class="fas fa-circle" style="color: #00ff00; font-size: 8px;"></i> ${user.status}
                            </div>
                        </div>
                    `;
                    listContainer.appendChild(userItem);
                });
            }

            // ⬇⬇⬇ دالة فتح/إغلاق نافذة الغرف ⬇⬇⬇
            function toggleRoomsSidebar() {
                const sidebar = document.getElementById('roomsSidebar');
                const onlineSidebar = document.getElementById('onlineUsersSidebar');

                if (onlineSidebar && onlineSidebar.classList.contains('active')) {
                    onlineSidebar.classList.remove('active');
                }

                if (sidebar) {
                    sidebar.classList.toggle('active');
                }
            }
            // ⬆⬆⬆ نهاية الدوال ⬆⬆⬆
            </script>
    
            <!-- القائمة الرئيسية -->
            <div id="mainMenuModal" class="modal">
                <div class="modal-content main-menu">
                    <div class="modal-header">
                        <h2>القائمة الرئيسية</h2>
                        <button class="close-btn" onclick="closeMainMenu()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="menu-items">
                        <div class="menu-item" onclick="openNewsSection()">
                            <i class="fas fa-newspaper"></i>
                            <span>الأخبار</span>
                            <p>انشر الأخبار والتحديثات</p>
                        </div>
                        <div class="menu-item" onclick="openStoriesSection()">
                            <i class="fas fa-images"></i>
                            <span>القصص اليومية</span>
                            <p>شارك قصتك اليومية</p>
                        </div>
                        <!-- ⬇⬇⬇ الزر الجديد الذي طلبتَه ⬇⬇⬇ -->
                        <div class="menu-item" onclick="openAppStore()">
                            <i class="fas fa-store"></i>
                            <span>متجر التطبيق</span>
                            <p>اشتري الإطارات والزخارف بالنقاط</p>
                        </div>
                        <!-- ⬆⬆⬆ نهاية الزر الجديد ⬆⬆⬆ -->
                        <div class="menu-item" onclick="openSendNotificationModal()">
                            <i class="fas fa-bell"></i>
                            <span>إرسال إشعار</span>
                            <p>إرسال إشعار لأي شخص</p>
                        </div>
                        <div class="menu-item" onclick="openOnlineUsersModal()">
                            <i class="fas fa-users"></i>
                            <span>المتصلين حالياً</span>
                            <p>عرض قائمة المتصلين</p>
                        </div>
                        <div class="menu-item" onclick="openGamesSection()">
                            <i class="fas fa-gamepad"></i>
                            <span>الألعاب</span>
                            <p>العب مع الأصدقاء</p>
                        </div>
                        <div class="menu-item" onclick="openQuizRoom()">
                            <i class="fas fa-question-circle"></i>
                            <span>غرفة المسابقات</span>
                            <p>اختبر معلوماتك واربح النقاط</p>
                        </div>
                        <div class="menu-item" onclick="openRoomsManager()" id="roomsManagerBtn" style="display: none;">
                            <i class="fas fa-door-open"></i>
                            <span>إدارة الغرف</span>
                            <p>إنشاء وإدارة الغرف</p>
                        </div>
                        <div class="menu-item" onclick="openCoinsShop()">
                            <i class="fas fa-coins"></i>
                            <span>متجر النقاط</span>
                            <p>اشتري المميزات بالنقاط</p>
                        </div>
                        <div class="menu-item" onclick="openAdminPanel()" id="adminPanelBtn" style="display: none;">
                            <i class="fas fa-crown"></i>
                            <span>لوحة الإدارة</span>
                            <p>إدارة المستخدمين والنظام</p>
                        </div>

                        <!-- 🎯 صندوق الرسالة المميزة - جديد -->
                        <div class="menu-item" onclick="openSpecialMessageBox()">
                            <i class="fas fa-paint-brush"></i>
                            <span>رسالة مميزة</span>
                            <p>أرسل رسالة بلون مخصص للغرفة</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- نافذة الرسالة المميزة -->
            <div id="specialMessageModal" class="modal">
                <div class="modal-content special-message-box">
                    <div class="modal-header">
                        <h2>رسالة مميزة</h2>
                        <button class="close-btn" onclick="closeSpecialMessageBox()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="color-picker-container">
                        <div class="color-grid" id="colorGrid">
                            <!-- سيتم تعبئة الألوان بواسطة JS أو يمكن إضافتها يدويًا -->
                        </div>
                        <div class="nav-buttons">
                            <button onclick="prevPage()"><i class="fas fa-chevron-left"></i></button>
                            <button onclick="nextPage()"><i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                    <div class="message-input-container">
                        <textarea id="specialMessageInput" placeholder="اكتب رسالتك هنا..."></textarea>
                        <button onclick="sendSpecialMessage()">إرسال</button>
                    </div>
                </div>
            </div>
            <!-- مودال الملف الشخصي -->
            <div id="profileModal" class="modal">
                <div class="modal-content profile-modal">
                    <div class="modal-header">
                        <h2>الملف الشخصي</h2>
                        <div class="header-actions">
                            <button class="menu-btn" onclick="toggleProfileMenu()">
                                <i class="fas fa-bars"></i>
                            </button>
                            <button class="close-btn" onclick="closeProfileModal()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <!-- قائمة منسدلة صغيرة -->
                    <div id="profileMenuDropdown" class="profile-menu-dropdown">
                        <div class="menu-item" onclick="menuAction('private')">
                            <i class="fas fa-comment"></i>
                            <span>Private</span>
                        </div>
                        <div class="menu-item" onclick="menuAction('remove')">
                            <i class="fas fa-user-minus"></i>
                            <span>Remove friend</span>
                        </div>
                        <div class="menu-item" onclick="menuAction('gift')">
                            <i class="fas fa-gift"></i>
                            <span>Send gift</span>
                        </div>
                        <div class="menu-item" onclick="menuAction('wallet')">
                            <i class="fas fa-wallet"></i>
                            <span>Share wallet</span>
                        </div>
                        <div class="menu-item" onclick="menuAction('ignore')">
                            <i class="fas fa-ban"></i>
                            <span>Ignore</span>
                        </div>
                    </div>
                    <div class="profile-content">
                        <div class="profile-cover">
                            <img id="profileCover" src="https://images.pexels.com/photos/1323550/pexels-photo-1323550.jpeg?auto=compress&cs=tinysrgb&w=800&h=300&fit=crop" alt="خلفية البروفايل">
                            <input type="file" id="coverInput" accept="image/*" style="display: none;">
                            <button class="change-cover-btn" onclick="document.getElementById('coverInput').click()">
                                <i class="fas fa-camera"></i>
                                تغيير الخلفية
                            </button>
                        </div>
                        <div class="profile-info">
                            <div class="profile-avatar-section">
                                <div class="profile-avatars">
                                    <div class="avatar-slot">
                                        <img id="profileImg1" src="https://images.pexels.com/photos/771742/pexels-photo-771742.jpeg?auto=compress&cs=tinysrgb&w=150&h=150&fit=crop" alt="صورة 1">
                                        <input type="file" id="profileFile1" accept="image/*" style="display: none;">
                                        <button onclick="document.getElementById('profileFile1').click()">
                                            <i class="fas fa-camera"></i>
                                        </button>
                                    </div>
                                    <div class="avatar-slot">
                                        <img id="profileImg2" src="https://images.pexels.com/photos/1040880/pexels-photo-1040880.jpeg?auto=compress&cs=tinysrgb&w=150&h=150&fit=crop" alt="صورة 2">
                                        <input type="file" id="profileFile2" accept="image/*" style="display: none;">
                                        <button onclick="document.getElementById('profileFile2').click()">
                                            <i class="fas fa-camera"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="profile-stats">
                                    <div class="stat-item">
                                        <span class="stat-number" id="profileLikes">0</span>
                                        <span class="stat-label">إعجاب</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-number" id="profileCoins">2000</span>
                                        <span class="stat-label">نقطة</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-number" id="profileRank">زائر</span>
                                        <span class="stat-label">الرتبة</span>
                                    </div>
                                </div>
                            </div>
                            <div class="profile-details">
                                <div class="profile-tabs">
                                    <button class="tab-btn active" onclick="showProfileTab('info')">
                                        <i class="fas fa-info-circle"></i>
                                        المعلومات
                                    </button>
                                    <button class="tab-btn" onclick="showProfileTab('settings')">
                                        <i class="fas fa-cog"></i>
                                        الإعدادات
                                    </button>
                                    <button class="tab-btn" onclick="showProfileTab('music')">
                                        <i class="fas fa-music"></i>
                                        الموسيقى
                                    </button>
                                    <button class="tab-btn" onclick="showProfileTab('decorations')">
                                        <i class="fas fa-palette"></i>
                                        الزخارف
                                    </button>
                                </div>
                                <!-- تبويب المعلومات -->
                                <div id="profileInfoTab" class="profile-tab active">
                                    <div class="info-section">
                                        <label>الاسم المعروض:</label>
                                        <input type="text" id="displayNameInput" placeholder="اسمك المعروض">
                                    </div>
                                    <div class="info-section">
                                        <label>البريد الإلكتروني:</label>
                                        <input type="email" id="emailInput" placeholder="بريدك الإلكتروني">
                                    </div>
                                    <div class="info-section">
                                        <label>كلمة المرور الجديدة:</label>
                                        <input type="password" id="newPasswordInput" placeholder="كلمة المرور الجديدة">
                                    </div>
                                    <div class="info-section">
                                        <label>العمر:</label>
                                        <input type="number" id="ageInput" min="13" max="100">
                                    </div>
                                    <div class="info-section">
                                        <label>الجنس:</label>
                                        <select id="genderInput">
                                            <option value="">غير محدد</option>
                                            <option value="ذكر">ذكر</option>
                                            <option value="أنثى">أنثى</option>
                                        </select>
                                    </div>
                                    <div class="info-section">
                                        <label>الحالة الاجتماعية:</label>
                                        <select id="maritalStatusInput">
                                            <option value="">غير محدد</option>
                                            <option value="أعزب">أعزب</option>
                                            <option value="مرتبط">مرتبط</option>
                                            <option value="متزوج">متزوج</option>
                                        </select>
                                    </div>
                                    <div class="info-section">
                                        <label>نبذة عني:</label>
                                        <textarea id="aboutMeInput" placeholder="اكتب شيئاً عن نفسك..."></textarea>
                                    </div>
                                    <button onclick="updateProfile()" class="btn save-btn">
                                        <i class="fas fa-save"></i>
                                        حفظ التغييرات
                                    </button>
                                </div>
                                <!-- تبويب الإعدادات -->
                                <div id="profileSettingsTab" class="profile-tab">
                                    <!-- إعدادات الموقع والدولة -->
                                    <div class="settings-section location-settings">
                                        <h4><i class="fas fa-globe"></i> إعدادات الموقع والدولة</h4>

                                        <div class="location-info-box">
                                            <div class="current-location">
                                                <h5>موقعك الحالي:</h5>
                                                <div class="location-details">
                                                    <p><strong>🌍 الدولة:</strong> <span id="currentCountry">جاري التحميل...</span></p>
                                                    <p><strong>🏙️ المدينة:</strong> <span id="currentCity">جاري التحميل...</span></p>
                                                    <p><strong>📍 IP:</strong> <span id="currentIP">جاري التحميل...</span></p>
                                                    <p><strong>🕐 التوقيت المحلي:</strong> <span id="currentTime">--:--:--</span></p>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="country-selector">
                                            <label>اختر الدولة التي تريد عرضها في البروفايل:</label>
                                            <select id="countrySelect" onchange="updateSelectedCountry()">
                                                <option value="auto">🔄 تحديد تلقائي (استخدام موقعك الحقيقي)</option>
                                                <optgroup label="🌍 الدول العربية">
                                                    <option value="مصر">🇪🇬 مصر</option>
                                                    <option value="السعودية">🇸🇦 السعودية</option>
                                                    <option value="الإمارات">🇦🇪 الإمارات</option>
                                                    <option value="الأردن">🇯🇴 الأردن</option>
                                                    <option value="العراق">🇮🇶 العراق</option>
                                                    <option value="سوريا">🇸🇾 سوريا</option>
                                                    <option value="لبنان">🇱🇧 لبنان</option>
                                                    <option value="المغرب">🇲🇦 المغرب</option>
                                                    <option value="الجزائر">🇩🇿 الجزائر</option>
                                                    <option value="تونس">🇹🇳 تونس</option>
                                                    <option value="فلسطين">🇵🇸 فلسطين</option>
                                                    <option value="اليمن">🇾🇪 اليمن</option>
                                                    <option value="الكويت">🇰🇼 الكويت</option>
                                                    <option value="قطر">🇶🇦 قطر</option>
                                                    <option value="البحرين">🇧🇭 البحرين</option>
                                                    <option value="عمان">🇴🇲 عمان</option>
                                                    <option value="ليبيا">🇱🇾 ليبيا</option>
                                                    <option value="السودان">🇸🇩 السودان</option>
                                                    <option value="الصومال">🇸🇴 الصومال</option>
                                                    <option value="جيبوتي">🇩🇯 جيبوتي</option>
                                                    <option value="موريتانيا">🇲🇷 موريتانيا</option>
                                                    <option value="جزر القمر">🇰🇲 جزر القمر</option>
                                                </optgroup>
                                                <optgroup label="🌎 أمريكا الشمالية">
                                                    <option value="الولايات المتحدة">🇺🇸 الولايات المتحدة</option>
                                                    <option value="كندا">🇨🇦 كندا</option>
                                                    <option value="المكسيك">🇲🇽 المكسيك</option>
                                                </optgroup>
                                                <optgroup label="🌎 أمريكا الجنوبية">
                                                    <option value="البرازيل">🇧🇷 البرازيل</option>
                                                    <option value="الأرجنتين">🇦🇷 الأرجنتين</option>
                                                    <option value="تشيلي">🇨🇱 تشيلي</option>
                                                    <option value="كولومبيا">🇨🇴 كولومبيا</option>
                                                    <option value="بيرو">🇵🇪 بيرو</option>
                                                    <option value="فنزويلا">🇻🇪 فنزويلا</option>
                                                </optgroup>
                                                <optgroup label="🌍 أوروبا">
                                                    <option value="المملكة المتحدة">🇬🇧 المملكة المتحدة</option>
                                                    <option value="ألمانيا">🇩🇪 ألمانيا</option>
                                                    <option value="فرنسا">🇫🇷 فرنسا</option>
                                                    <option value="إيطاليا">🇮🇹 إيطاليا</option>
                                                    <option value="إسبانيا">🇪🇸 إسبانيا</option>
                                                    <option value="البرتغال">🇵🇹 البرتغال</option>
                                                    <option value="هولندا">🇳🇱 هولندا</option>
                                                    <option value="بلجيكا">🇧🇪 بلجيكا</option>
                                                    <option value="سويسرا">🇨🇭 سويسرا</option>
                                                    <option value="النمسا">🇦🇹 النمسا</option>
                                                    <option value="السويد">🇸🇪 السويد</option>
                                                    <option value="النرويج">🇳🇴 النرويج</option>
                                                    <option value="الدنمارك">🇩🇰 الدنمارك</option>
                                                    <option value="فنلندا">🇫🇮 فنلندا</option>
                                                    <option value="بولندا">🇵🇱 بولندا</option>
                                                    <option value="أوكرانيا">🇺🇦 أوكرانيا</option>
                                                    <option value="روسيا">🇷🇺 روسيا</option>
                                                    <option value="تركيا">🇹🇷 تركيا</option>
                                                    <option value="اليونان">🇬🇷 اليونان</option>
                                                    <option value="رومانيا">🇷🇴 رومانيا</option>
                                                    <option value="التشيك">🇨🇿 التشيك</option>
                                                    <option value="المجر">🇭🇺 المجر</option>
                                                </optgroup>
                                                <optgroup label="🌏 آسيا">
                                                    <option value="الصين">🇨🇳 الصين</option>
                                                    <option value="اليابان">🇯🇵 اليابان</option>
                                                    <option value="كوريا الجنوبية">🇰🇷 كوريا الجنوبية</option>
                                                    <option value="كوريا الشمالية">🇰🇵 كوريا الشمالية</option>
                                                    <option value="الهند">🇮🇳 الهند</option>
                                                    <option value="باكستان">🇵🇰 باكستان</option>
                                                    <option value="بنغلاديش">🇧🇩 بنغلاديش</option>
                                                    <option value="إندونيسيا">🇮🇩 إندونيسيا</option>
                                                    <option value="ماليزيا">🇲🇾 ماليزيا</option>
                                                    <option value="تايلاند">🇹🇭 تايلاند</option>
                                                    <option value="فيتنام">🇻🇳 فيتنام</option>
                                                    <option value="الفلبين">🇵🇭 الفلبين</option>
                                                    <option value="سنغافورة">🇸🇬 سنغافورة</option>
                                                    <option value="أفغانستان">🇦🇫 أفغانستان</option>
                                                    <option value="إيران">🇮🇷 إيران</option>
                                                    <option value="أذربيجان">🇦🇿 أذربيجان</option>
                                                    <option value="كازاخستان">🇰🇿 كازاخستان</option>
                                                    <option value="أوزبكستان">🇺🇿 أوزبكستان</option>
                                                </optgroup>
                                                <optgroup label="🌍 أفريقيا">
                                                    <option value="نيجيريا">🇳🇬 نيجيريا</option>
                                                    <option value="إثيوبيا">🇪🇹 إثيوبيا</option>
                                                    <option value="كينيا">🇰🇪 كينيا</option>
                                                    <option value="جنوب أفريقيا">🇿🇦 جنوب أفريقيا</option>
                                                    <option value="غانا">🇬🇭 غانا</option>
                                                    <option value="تنزانيا">🇹🇿 تنزانيا</option>
                                                    <option value="أوغندا">🇺🇬 أوغندا</option>
                                                    <option value="الكاميرون">🇨🇲 الكاميرون</option>
                                                    <option value="كوت ديفوار">🇨🇮 كوت ديفوار</option>
                                                    <option value="السنغال">🇸🇳 السنغال</option>
                                                </optgroup>
                                                <optgroup label="🌏 أوقيانوسيا">
                                                    <option value="أستراليا">🇦🇺 أستراليا</option>
                                                    <option value="نيوزيلندا">🇳🇿 نيوزيلندا</option>
                                                </optgroup>
                                            </select>
                                            <p class="note">💡 يمكنك تغيير الدولة المعروضة حتى لو كنت في دولة أخرى</p>
                                        </div>

                                        <button onclick="detectLocation()" class="btn detect-btn">
                                            <i class="fas fa-compass"></i>
                                            اكتشف موقعي الحالي
                                        </button>
                                    </div>

                                    <div class="settings-section">
                                        <h4>لون الاسم</h4>
                                        <input type="color" id="nameColorPicker" value="#ffffff">
                                        <button onclick="updateNameColor()" class="btn">تطبيق اللون</button>
                                    </div>
                                    <div class="settings-section">
                                        <h4>لون الخط</h4>
                                        <input type="color" id="fontColorPicker" value="#000000">
                                        <button onclick="updateFontColor()" class="btn">تطبيق اللون</button>
                                    </div>
                                    <div class="settings-section">
                                        <h4>خلفية الرسائل</h4>
                                        <input type="file" id="messageBackgroundInput" accept="image/*">
                                        <button onclick="uploadMessageBackground()" class="btn">تحديث الخلفية</button>
                                    </div>
                                </div>
                                <!-- تبويب الموسيقى -->
                                <div id="profileMusicTab" class="profile-tab">
                                    <div class="music-section">
                                        <h4>موسيقى البروفايل</h4>
                                        <input type="file" id="profileMusicInput" accept="audio/*">
                                        <div id="currentMusic" class="current-music">
                                            <audio id="profileAudio" controls style="display: none;"></audio>
                                        </div>
                                        <button onclick="uploadProfileMusic()" class="btn">رفع موسيقى</button>
                                        <button onclick="removeProfileMusic()" class="btn btn-danger">إزالة الموسيقى</button>
                                        <p class="feature-note">متاح للرتب العالية فقط</p>
                                    </div>
                                </div>
                                <!-- تبويب الزخارف -->
                                <div id="profileDecorationsTab" class="profile-tab">
                                    <div class="decorations-section">
                                        <h4>زخرفة الاسم</h4>
                                        <select id="nameDecorationSelect">
                                            <option value="">بدون زخرفة</option>
                                            <option value="fire">نار 🔥</option>
                                            <option value="star">نجوم ⭐</option>
                                            <option value="crown">تاج 👑</option>
                                            <option value="diamond">ماس 💎</option>
                                            <option value="rainbow">قوس قزح 🌈</option>
                                        </select>
                                        <button onclick="updateNameDecoration()" class="btn">تطبيق الزخرفة</button>
                                        <p class="feature-note">بعض الزخارف متاحة للرتب العالية فقط</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- مودال عرض ملف شخصي آخر -->
            <div id="viewProfileModal" class="modal">
                <div class="modal-content profile-modal">
                    <div class="modal-header">
                        <h2 id="viewProfileName">الملف الشخصي</h2>
                        <button class="close-btn" onclick="closeViewProfileModal()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="profile-content">
                        <div class="profile-cover">
                            <img id="viewProfileCover" src="" alt="خلفية البروفايل">
                        </div>
                        <div class="profile-info">
                            <div class="profile-avatar-section">
                                <div class="profile-avatars">
                                    <div class="avatar-slot">
                                        <img id="viewProfileImg1" src="" alt="صورة 1">
                                    </div>
                                    <div class="avatar-slot">
                                        <img id="viewProfileImg2" src="" alt="صورة 2">
                                    </div>
                                </div>
                                <div class="profile-stats">
                                    <div class="stat-item">
                                        <span class="stat-number" id="viewProfileLikes">0</span>
                                        <span class="stat-label">إعجاب</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-number" id="viewProfileCoins">0</span>
                                        <span class="stat-label">نقطة</span>
                                    </div>
                                </div>
                                <div class="profile-actions">
                                    <button onclick="likeProfile()" class="btn like-btn">
                                        <i class="fas fa-heart"></i> إعجاب
                                    </button>
                                    <button onclick="startPrivateChat()" class="btn message-btn">
                                        <i class="fas fa-envelope"></i> رسالة
                                    </button>
                                </div>
                            </div>
                            <div class="profile-details">
                                <div id="viewProfileInfo" class="profile-info-display">
                                    <!-- سيتم ملؤها بالجافاسكريبت -->
                                </div>
                                <div id="viewProfileMusic" class="profile-music-display">
                                    <!-- موسيقى البروفايل -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- لوحة التحكم للمشرف (njdj9985@gmail.com فقط) -->
            <div id="adminPanel" class="modal">
                <div class="modal-content admin-modal">
                    <div class="modal-header">
                        <h2><i class="fas fa-user-shield"></i> لوحة التحكم - معلومات المستخدمين</h2>
                        <button class="close-btn" onclick="closeAdminPanel()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="admin-content">
                        <div class="admin-stats">
                            <div class="stat-card">
                                <i class="fas fa-users"></i>
                                <div>
                                    <h3 id="totalUsers">0</h3>
                                    <p>إجمالي المستخدمين</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-user-clock"></i>
                                <div>
                                    <h3 id="onlineUsers">0</h3>
                                    <p>المتصلين الآن</p>
                                </div>
                            </div>
                        </div>

                        <div class="users-table-container">
                            <h3><i class="fas fa-list"></i> قائمة المستخدمين المتصلين</h3>
                            <table class="users-table">
                                <thead>
                                    <tr>
                                        <th>الاسم</th>
                                        <th>الدولة المعروضة</th>
                                        <th>الدولة الحقيقية</th>
                                        <th>المدينة</th>
                                        <th>IP Address</th>
                                        <th>التوقيت المحلي</th>
                                        <th>وقت الدخول</th>
                                        <th>الحالة</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <!-- سيتم ملؤها ديناميكياً -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- زر لوحة التحكم -->
            <button id="adminPanelBtn" class="admin-panel-btn" onclick="openAdminPanel()" style="display: none;">
                <i class="fas fa-user-shield"></i>
                <span>لوحة التحكم</span>
            </button>

            <style>
            .header-actions {
                display: flex;
                gap: 10px;
                align-items: center;
                position: relative;
            }

            .menu-btn {
                background: none;
                border: none;
                color: #fff;
                cursor: pointer;
                padding: 8px;
                border-radius: 50%;
                transition: all 0.3s;
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .menu-btn:hover {
                background: rgba(255, 255, 255, 0.1);
            }

            .menu-btn i {
                font-size: 24px;
            }

            .close-btn {
                background: rgba(255, 255, 255, 0.2);
                border: none;
                color: #fff;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s;
            }

            .close-btn:hover {
                background: rgba(255, 255, 255, 0.3);
            }

            /* القائمة المنسدلة الصغيرة */
            .profile-menu-dropdown {
                position: absolute;
                top: 50px;
                right: 50px;
                background: #fff;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
                width: 200px;
                display: none;
                z-index: 1000;
                overflow: hidden;
            }

            .profile-menu-dropdown.active {
                display: block;
            }

            .menu-item {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 12px 15px;
                cursor: pointer;
                transition: all 0.3s;
                color: #333;
                border-bottom: 1px solid #f0f0f0;
            }

            .menu-item:last-child {
                border-bottom: none;
            }

            .menu-item:hover {
                background: #f5f5f5;
            }

            .menu-item i {
                font-size: 16px;
                width: 20px;
                color: #666;
            }

            .menu-item span {
                font-size: 14px;
                font-weight: 500;
            }

            /* إعدادات الموقع */
            .location-settings {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #fff;
                padding: 25px;
                border-radius: 15px;
                margin-bottom: 20px;
            }

            .location-settings h4 {
                color: #fff;
                margin-top: 0;
            }

            .location-info-box {
                background: rgba(255, 255, 255, 0.15);
                padding: 20px;
                border-radius: 12px;
                margin: 20px 0;
                backdrop-filter: blur(10px);
            }

            .current-location h5 {
                margin-top: 0;
                margin-bottom: 15px;
                font-size: 18px;
            }

            .location-details p {
                margin: 10px 0;
                font-size: 15px;
            }

            .country-selector {
                margin: 20px 0;
            }

            .country-selector label {
                display: block;
                margin-bottom: 10px;
                font-weight: bold;
            }

            .country-selector select {
                width: 100%;
                padding: 12px;
                border-radius: 10px;
                border: 2px solid rgba(255, 255, 255, 0.3);
                background: rgba(255, 255, 255, 0.9);
                color: #333;
                font-size: 14px;
                cursor: pointer;
            }

            .country-selector .note {
                margin-top: 10px;
                font-size: 13px;
                opacity: 0.9;
            }

            .detect-btn {
                background: rgba(255, 255, 255, 0.2);
                color: #fff;
                border: 2px solid #fff;
                padding: 12px 25px;
                border-radius: 25px;
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: 8px;
                font-weight: bold;
                transition: all 0.3s;
            }

            .detect-btn:hover {
                background: #fff;
                color: #667eea;
            }

            /* لوحة التحكم */
            .admin-panel-btn {
                position: fixed;
                bottom: 30px;
                right: 30px;
                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                color: #fff;
                border: none;
                padding: 15px 25px;
                border-radius: 50px;
                cursor: pointer;
                font-weight: bold;
                box-shadow: 0 5px 20px rgba(245, 87, 108, 0.4);
                display: flex;
                align-items: center;
                gap: 10px;
                z-index: 9998;
                transition: all 0.3s;
                animation: pulse 2s infinite;
            }

            .admin-panel-btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 25px rgba(245, 87, 108, 0.6);
            }

            @keyframes pulse {
                0%, 100% { box-shadow: 0 5px 20px rgba(245, 87, 108, 0.4); }
                50% { box-shadow: 0 5px 30px rgba(245, 87, 108, 0.7); }
            }

            .modal {
                display: none;
                position: fixed;
                z-index: 9999;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.7);
                backdrop-filter: blur(5px);
            }

            .modal.active {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .admin-modal {
                background: #fff;
                border-radius: 20px;
                width: 95%;
                max-width: 1400px;
                max-height: 90vh;
                overflow-y: auto;
            }

            .modal-header {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #fff;
                padding: 20px 30px;
                border-radius: 20px 20px 0 0;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .modal-header h2 {
                margin: 0;
                font-size: 24px;
            }

            .admin-content {
                padding: 30px;
            }

            .admin-stats {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }

            .stat-card {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #fff;
                padding: 25px;
                border-radius: 15px;
                display: flex;
                align-items: center;
                gap: 20px;
            }

            .stat-card i {
                font-size: 48px;
            }

            .stat-card h3 {
                font-size: 36px;
                margin: 0;
            }

            .stat-card p {
                margin: 5px 0 0 0;
            }

            .users-table-container {
                background: #f8f9fa;
                padding: 20px;
                border-radius: 15px;
            }

            .users-table-container h3 {
                margin-top: 0;
                color: #333;
            }

            .users-table {
                width: 100%;
                border-collapse: collapse;
                background: #fff;
                border-radius: 10px;
                overflow: hidden;
            }

            .users-table thead {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #fff;
            }

            .users-table th,
            .users-table td {
                padding: 15px;
                text-align: right;
                border-bottom: 1px solid #eee;
            }

            .users-table tbody tr:hover {
                background: #f8f9fa;
            }

            .status-badge {
                padding: 5px 12px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: bold;
            }

            .status-online {
                background: #4caf50;
                color: #fff;
            }

            /* تحسينات الإدخال */
            .profile-tab {
                display: none;
            }

            .profile-tab.active {
                display: block;
            }

            .info-section, .settings-section, .music-section, .decorations-section {
                margin-bottom: 20px;
            }

            .info-section label, .settings-section h4, .music-section h4, .decorations-section h4 {
                display: block;
                margin-bottom: 8px;
                font-weight: bold;
            }

            .info-section input, .info-section select, .info-section textarea {
                width: 100%;
                padding: 12px;
                border: 2px solid #e0e0e0;
                border-radius: 10px;
                font-size: 14px;
            }

            .btn {
                padding: 12px 25px;
                border: none;
                border-radius: 25px;
                cursor: pointer;
                font-weight: bold;
                transition: all 0.3s;
            }

            .save-btn {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #fff;
                width: 100%;
            }

            .btn-danger {
                background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
                color: #fff;
            }

            .btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            }
            </style>

            <script>
            // معلومات المشرف
            const ADMIN_EMAIL = 'njdj9985@gmail.com';
            const ADMIN_PASSWORD = 'Zxcvbnm.8';

            // قاعدة بيانات المستخدمين المتصلين
            let connectedUsers = [];
            let userLocationData = null;

            // دالة للحصول على الموقع الجغرافي
            async function detectLocation() {
                try {
                    document.getElementById('currentCountry').textContent = 'جاري التحديد...';
                    document.getElementById('currentCity').textContent = 'جاري التحديد...';
                    document.getElementById('currentIP').textContent = 'جاري التحديد...';

                    const response = await fetch('https://ipapi.co/json/');
                    const data = await response.json();

                    userLocationData = {
                        ip: data.ip,
                        country: data.country_name || 'Unknown',
                        countryCode: data.country_code || 'XX',
                        city: data.city || 'Unknown',
                        region: data.region || 'Unknown',
                        latitude: data.latitude || 0,
                        longitude: data.longitude || 0,
                        timezone: data.timezone || 'UTC',
                        org: data.org || 'Unknown ISP'
                    };

                    document.getElementById('currentCountry').textContent = userLocationData.country;
                    document.getElementById('currentCity').textContent = userLocationData.city;
                    document.getElementById('currentIP').textContent = userLocationData.ip;

                    updateLocalTime();
                    setInterval(updateLocalTime, 1000);

                    // حفظ البيانات
                    localStorage.setItem('userLocation', JSON.stringify(userLocationData));

                    // تسجيل دخول المستخدم للمشرف
                    registerUserLogin();

                    alert('✅ تم تحديد موقعك بنجاح!');
                } catch (error) {
                    console.error('خطأ في تحديد الموقع:', error);
                    alert('⚠️ تعذر تحديد موقعك. يرجى المحاولة لاحقاً.');
                }
            }

            // تحديث التوقيت المحلي
            function updateLocalTime() {
                if (userLocationData && userLocationData.timezone) {
                    try {
                        const time = new Date().toLocaleString('ar-EG', {
                            timeZone: userLocationData.timezone,
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit',
                            hour12: true
                        });
                        document.getElementById('currentTime').textContent = time;
                    } catch (e) {
                        document.getElementById('currentTime').textContent = new Date().toLocaleTimeString('ar-EG');
                    }
                }
            }

            // تحديث الدولة المختارة
            function updateSelectedCountry() {
                const selectedCountry = document.getElementById('countrySelect').value;
                localStorage.setItem('selectedCountry', selectedCountry);

                if (selectedCountry === 'auto') {
                    alert('✅ سيتم عرض موقعك الحقيقي في البروفايل');
                } else {
                    alert(`✅ سيتم عرض ${selectedCountry} في البروفايل الخاص بك`);
                }
            }

            // تسجيل دخول المستخدم
            function registerUserLogin() {
                const userName = document.getElementById('displayNameInput').value || 'زائر';
                const userEmail = document.getElementById('emailInput').value || '';
                const selectedCountry = document.getElementById('countrySelect').value;

                const userEntry = {
                    id: Date.now(),
                    name: userName,
                    email: userEmail,
                    realLocation: userLocationData,
                    displayCountry: selectedCountry === 'auto' ? userLocationData.country : selectedCountry,
                    loginTime: new Date().toLocaleString('ar-EG'),
                    status: 'online'
                };

                connectedUsers.push(userEntry);

                // حفظ في localStorage
                const savedUsers = JSON.parse(localStorage.getItem('allUsers') || '[]');
                savedUsers.push(userEntry);
                localStorage.setItem('allUsers', JSON.stringify(savedUsers));

                updateAdminPanel();
            }

            // تحديث لوحة التحكم
            function updateAdminPanel() {
                const savedUsers = JSON.parse(localStorage.getItem('allUsers') || '[]');

                document.getElementById('totalUsers').textContent = savedUsers.length;
                document.getElementById('onlineUsers').textContent = savedUsers.filter(u => u.status === 'online').length;

                const tbody = document.getElementById('usersTableBody');
                tbody.innerHTML = '';

                savedUsers.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.name}</td>
                        <td>${user.displayCountry}</td>
                        <td>${user.realLocation ? user.realLocation.country : 'غير محدد'}</td>
                        <td>${user.realLocation ? user.realLocation.city : 'غير محدد'}</td>
                        <td>${user.realLocation ? user.realLocation.ip : 'غير محدد'}</td>
                        <td>${user.realLocation ? getLocalTime(user.realLocation.timezone) : '--:--'}</td>
                        <td>${user.loginTime}</td>
                        <td><span class="status-badge status-${user.status}">${user.status === 'online' ? 'متصل' : 'غير متصل'}</span></td>
                    `;
                    tbody.appendChild(row);
                });
            }

            // الحصول على التوقيت المحلي
            function getLocalTime(timezone) {
                try {
                    return new Date().toLocaleString('ar-EG', {
                        timeZone: timezone,
                        hour: '2-digit',
                        minute: '2-digit',
                        hour12: true
                    });
                } catch (e) {
                    return '--:--';
                }
            }

            // فتح لوحة التحكم
            function openAdminPanel() {
                const userEmail = localStorage.getItem('userEmail');
                if (userEmail === ADMIN_EMAIL) {
                    document.getElementById('adminPanel').classList.add('active');
                    updateAdminPanel();
                } else {
                    alert('⛔ ليس لديك صلاحية للوصول');
                }
            }

            // إغلاق لوحة التحكم
            function closeAdminPanel() {
                document.getElementById('adminPanel').classList.remove('active');
            }

            // إظهار زر لوحة التحكم للمشرف
            function checkAdminAccess() {
                const userEmail = localStorage.getItem('userEmail');
                if (userEmail === ADMIN_EMAIL) {
                    document.getElementById('adminPanelBtn').style.display = 'flex';
                }
            }

            function toggleProfileMenu() {
                const dropdown = document.getElementById('profileMenuDropdown');
                dropdown.classList.toggle('active');
            }

            function menuAction(action) {
                console.log('تم اختيار: ' + action);
                toggleProfileMenu();

                switch(action) {
                    case 'private':
                        alert('فتح محادثة خاصة');
                        break;
                    case 'remove':
                        alert('إزالة صديق');
                        break;
                    case 'gift':
                        alert('إرسال هدية');
                        break;
                    case 'wallet':
                        alert('مشاركة المحفظة');
                        break;
                    case 'ignore':
                        alert('تجاهل المستخدم');
                        break;
                }
            }

            function showProfileTab(tabName) {
                document.querySelectorAll('.profile-tab').forEach(tab => {
                    tab.classList.remove('active');
                });

                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                const targetTab = document.getElementById('profile' + tabName.charAt(0).toUpperCase() + tabName.slice(1) + 'Tab');
                if (targetTab) {
                    targetTab.classList.add('active');
                }

                if (event && event.target) {
                    event.target.classList.add('active');
                }
            }

            function updateProfile() {
                const name = document.getElementById('displayNameInput').value;
                const email = document.getElementById('emailInput').value;

                localStorage.setItem('userName', name);
                localStorage.setItem('userEmail', email);

                alert('✅ تم حفظ التغييرات بنجاح!');

                checkAdminAccess();
                registerUserLogin();
            }

            function updateNameColor() {
                const color = document.getElementById('nameColorPicker').value;
                alert('تم تطبيق لون الاسم: ' + color);
            }

            function updateFontColor() {
                const color = document.getElementById('fontColorPicker').value;
                alert('تم تطبيق لون الخط: ' + color);
            }

            function uploadMessageBackground() {
                alert('تم تحديث خلفية الرسائل');
            }

            function uploadProfileMusic() {
                alert('تم رفع الموسيقى');
            }

            function removeProfileMusic() {
                alert('تم إزالة الموسيقى');
            }

            function updateNameDecoration() {
                alert('تم تطبيق الزخرفة');
            }

            function closeProfileModal() {
                document.getElementById('profileModal').classList.remove('active');
            }

            function closeViewProfileModal() {
                document.getElementById('viewProfileModal').classList.remove('active');
            }

            function likeProfile() {
                alert('❤️ تم الإعجاب');
            }

            function startPrivateChat() {
                alert('💬 بدء محادثة');
            }

            // إغلاق القوائم عند الضغط خارجها
            document.addEventListener('click', function(event) {
                const dropdown = document.getElementById('profileMenuDropdown');
                const menuBtn = document.querySelector('.menu-btn');

                if (dropdown && !dropdown.contains(event.target) && !menuBtn.contains(event.target)) {
                    dropdown.classList.remove('active');
                }
            });

            // تحميل البيانات عند بدء الصفحة
            window.addEventListener('load', function() {
                // تحميل الموقع المحفوظ
                const savedLocation = localStorage.getItem('userLocation');
                if (savedLocation) {
                    userLocationData = JSON.parse(savedLocation);
                    document.getElementById('currentCountry').textContent = userLocationData.country;
                    document.getElementById('currentCity').textContent = userLocationData.city;
                    document.getElementById('currentIP').textContent = userLocationData.ip;
                    updateLocalTime();
                    setInterval(updateLocalTime, 1000);
                } else {
                    detectLocation();
                }

                // تحميل الدولة المختارة
                const selectedCountry = localStorage.getItem('selectedCountry');
                if (selectedCountry) {
                    document.getElementById('countrySelect').value = selectedCountry;
                }

                // تحميل معلومات المستخدم
                const userName = localStorage.getItem('userName');
                const userEmail = localStorage.getItem('userEmail');
                if (userName) document.getElementById('displayNameInput').value = userName;
                if (userEmail) document.getElementById('emailInput').value = userEmail;

                // التحقق من صلاحيات المشرف
                checkAdminAccess();
            });
            </script>
            <!-- مودال الأخبار -->
            <div id="newsModal" class="modal">
                <div class="modal-content news-modal">
                    <div class="modal-header">
                        <h2>📰 قناة الأخبار</h2>
                        <button class="close-btn" onclick="closeNewsModal()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="news-content">
                        <div class="news-post-form">
                            <textarea id="newsContentInput" placeholder="اكتب خبرًا..." maxlength="500"></textarea>
                            <div class="news-form-actions">
                                <input type="file" id="newsFileInput" accept="image/*,video/*" style="display: none;">
                                <button onclick="document.getElementById('newsFileInput').click()" class="btn btn-secondary">
                                    <i class="fas fa-image"></i>
                                    اختر صورة أو فيديو
                                </button>
                                <button onclick="postNews()" class="btn btn-primary">
                                    <i class="fas fa-paper-plane"></i>
                                    نشر
                                </button>
                            </div>
                        </div>
                        <div id="newsFeed" class="news-feed">
                            <!-- سيتم ملؤها بالجافاسكريبت -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- مودال القصص -->
            <div id="storiesModal" class="modal">
                <div class="modal-content stories-modal">
                    <div class="modal-header">
                        <h2>📸 القصص اليومية</h2>
                        <button class="close-btn" onclick="closeStoriesModal()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="stories-content">
                        <div class="add-story-section">
                            <button onclick="openAddStoryModal()" class="btn add-story-btn">
                                <i class="fas fa-plus"></i> إضافة قصة
                            </button>
                        </div>
                        <div id="storiesContainer" class="stories-container">
                            <!-- سيتم ملؤها بالجافاسكريبت -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- مودال إضافة قصة -->
            <div id="addStoryModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>إضافة قصة جديدة</h2>
                        <button class="close-btn" onclick="closeAddStoryModal()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="story-form">
                        <input type="file" id="storyMediaInput" accept="image/*,video/*" required>
                        <textarea id="storyTextInput" placeholder="نص القصة (اختياري)"></textarea>
                        <button onclick="addStory()" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            إضافة القصة
                        </button>
                    </div>
                </div>
            </div>
            <!-- مودال غرفة المسابقات -->
            <div id="quizRoomModal" class="modal">
                <div class="modal-content quiz-room-modal">
                    <div class="modal-header">
                        <h2>🏆 غرفة المسابقات</h2>
                        <button class="close-btn" onclick="closeQuizRoom()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="quiz-content">
                        <div class="quiz-stats">
                            <div class="stat-item">
                                <span>نقاطك:</span>
                                <span id="userQuizPoints">0</span>
                            </div>
                            <div class="stat-item">
                                <span>الترتيب:</span>
                                <span id="userQuizRank">#-</span>
                            </div>
                        </div>
                        <div id="quizQuestion" class="quiz-question">
                            <h3 id="questionText">مرحباً بك في غرفة المسابقات!</h3>
                            <div id="questionOptions" class="question-options"></div>
                            <div class="quiz-timer">
                                <span>الوقت المتبقي: </span>
                                <span id="quizTimer">20</span>
                                <span> ثانية</span>
                            </div>
                        </div>
                        <div id="quizLeaderboard" class="quiz-leaderboard">
                            <h4>لوحة المتصدرين</h4>
                            <div id="leaderboardList"></div>
                        </div>
                    </div>
                </div>
            </div>
    <!-- مودال لوحة الإدارة -->
    <div id="adminModal" class="modal">
        <div class="modal-content admin-modal">
            <div class="modal-header">
                <h2>👑 لوحة الإدارة</h2>
                <button class="close-btn" onclick="closeAdminModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="admin-content">
                <div class="admin-tabs">
                    <button class="tab-btn active" onclick="showAdminTab('users')">
                        <i class="fas fa-users"></i>
                        إدارة المستخدمين
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('ranks')">
                        <i class="fas fa-crown"></i>
                        الرتب
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('rooms')">
                        <i class="fas fa-door-open"></i>
                        الغرف
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('bans')">
                        <i class="fas fa-ban"></i>
                        الحظر والكتم
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('coins')">
                        <i class="fas fa-coins"></i>
                        النقاط
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('notifications')">
                        <i class="fas fa-bell"></i>
                        الإشعارات
                    </button>
                </div>
                <div id="adminUsersTab" class="admin-tab active">
                    <div class="admin-actions">
                        <button onclick="refreshUsersList()" class="btn">
                            <i class="fas fa-sync-alt"></i>
                            تحديث القائمة
                        </button>
                    </div>
                    <div id="adminUsersList" class="admin-users-list">
                        <!-- سيتم ملؤها بالجافاسكريبت -->
                    </div>
                </div>
                <div id="adminRanksTab" class="admin-tab">
                    <div class="ranks-management">
                        <h3>الرتب المتاحة</h3>
                        <div id="ranksList" class="ranks-list">
                            <!-- سيتم ملؤها بالجافاسكريبت -->
                        </div>
                    </div>
                </div>
                <div id="adminRoomsTab" class="admin-tab">
                    <div class="rooms-management">
                        <button onclick="openCreateRoomModal()" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            إنشاء غرفة جديدة
                        </button>
                        <div id="adminRoomsList" class="admin-rooms-list">
                            <!-- سيتم ملؤها بالجافاسكريبت -->
                        </div>
                    </div>
                </div>
                <div id="adminBansTab" class="admin-tab">
                    <div class="bans-management">
                        <h3>المستخدمون المحظورون</h3>
                        <div id="bannedUsersList" class="banned-users-list">
                            <!-- سيتم ملؤها بالجافاسكريبت -->
                        </div>
                    </div>
                </div>
                <div id="adminCoinsTab" class="admin-tab">
                    <div class="coins-management">
                        <h3>إدارة النقاط</h3>
                        <div class="coins-form">
                            <select id="coinsUserSelect">
                                <option value="">اختر المستخدم</option>
                            </select>
                            <input type="number" id="coinsAmount" placeholder="عدد النقاط">
                            <button onclick="giveCoins()" class="btn btn-primary">
                                <i class="fas fa-coins"></i>
                                إعطاء نقاط
                            </button>
                        </div>
                    </div>
                </div>
                <div id="adminNotificationsTab" class="admin-tab">
                    <div class="notifications-management">
                        <h3>إرسال إشعارات</h3>
                        <div class="notification-form">
                            <select id="notificationTarget">
                                <option value="all">للجميع</option>
                                <option value="specific">لمستخدم محدد</option>
                            </select>
                            <select id="specificUserSelect" style="display: none;">
                                <option value="">اختر المستخدم</option>
                            </select>
                            <textarea id="notificationMessage" placeholder="نص الإشعار"></textarea>
                            <button onclick="sendNotification()" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i>
                                إرسال الإشعار
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- مودال إجراءات المستخدم -->
    <div id="userActionsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>إجراءات المستخدم</h2>
                <button class="close-btn" onclick="closeUserActionsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="user-actions">
                <div class="user-info">
                    <img id="actionUserAvatar" src="" alt="">
                    <span id="actionUserName"></span>
                </div>
                <div class="actions-grid">
                    <button onclick="viewUserProfile()" class="action-btn">
                        <i class="fas fa-user"></i>
                        <span>عرض الملف الشخصي</span>
                    </button>
                    <button onclick="startPrivateChat()" class="action-btn">
                        <i class="fas fa-envelope"></i>
                        <span>رسالة خاصة</span>
                    </button>
                    <button onclick="openBanUserModal()" class="action-btn ban-btn admin-only">
                        <i class="fas fa-ban"></i>
                        <span>حظر</span>
                    </button>
                    <button onclick="openMuteUserModal()" class="action-btn mute-btn admin-only">
                        <i class="fas fa-volume-mute"></i>
                        <span>كتم</span>
                    </button>
                    <button onclick="openAssignRankModal()" class="action-btn rank-btn admin-only">
                        <i class="fas fa-crown"></i>
                        <span>تعيين رتبة</span>
                    </button>
                    <button onclick="openGiveCoinsModal()" class="action-btn coins-btn admin-only">
                        <i class="fas fa-coins"></i>
                        <span>إعطاء نقاط</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- مودال حظر المستخدم -->
    <div id="banUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>إدارة المستخدم</h2>
                <button class="close-btn" onclick="closeBanUserModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="ban-form">
                <div class="form-group">
                    <label>سبب الإجراء:</label>
                    <textarea id="banReason" placeholder="اكتب سبب الحظر أو الكتم..." required></textarea>
                </div>
                <div class="form-actions">
                    <button onclick="confirmBanUser()" class="btn ban-btn">
                        <i class="fas fa-ban"></i>
                        تأكيد الحظر الدائم
                    </button>
                    <button onclick="unbanUser()" class="btn unban-btn">
                        <i class="fas fa-unlock"></i>
                        فك الحظر
                    </button>
                    <button onclick="muteUser()" class="btn mute-btn">
                        <i class="fas fa-microphone-slash"></i>
                        كتم المستخدم
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- مودال تعيين الرتبة -->
    <div id="assignRankModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>تعيين رتبة</h2>
                <button class="close-btn" onclick="closeAssignRankModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="rank-form">
                <div class="form-group">
                    <label>المستخدم:</label>
                    <span id="rankTargetUser"></span>
                </div>
                <div class="form-group">
                    <label>الرتبة الجديدة:</label>
                    <select id="newRankSelect">
                        <option value="visitor">زائر</option>
                        <option value="bronze">عضو برونزي</option>
                        <option value="silver">عضو فضي</option>
                        <option value="gold">عضو ذهبي</option>
                        <option value="trophy">كأس</option>
                        <option value="diamond">عضو الماس</option>
                        <option value="prince">برنس</option>
                        <option value="admin">إداري</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>سبب التغيير:</label>
                    <textarea id="rankChangeReason" placeholder="سبب تغيير الرتبة (اختياري)"></textarea>
                </div>
                <button onclick="confirmAssignRank()" class="btn btn-primary">
                    <i class="fas fa-crown"></i>
                    تعيين الرتبة
                </button>
            </div>
        </div>
    </div>
    <!-- مودال الإشعارات -->
    <div id="notificationsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>الإشعارات</h2>
                <button class="close-btn" onclick="closeNotificationsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="notificationsList" class="notifications-list">
                <!-- سيتم ملؤها بالجافاسكريبت -->
            </div>
        </div>
    </div>
    <!-- مودال الإعدادات -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>الإعدادات</h2>
                <button class="close-btn" onclick="closeSettingsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="settings-content">
                <div class="settings-section">
                    <h3>إعدادات الصوت</h3>
                    <div class="setting-item">
                        <label>أصوات الإشعارات</label>
                        <label class="switch">
                            <input type="checkbox" id="soundNotifications" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>إعدادات الدردشة</h3>
                    <div class="setting-item">
                        <label>حفظ تاريخ الدردشة</label>
                        <label class="switch">
                            <input type="checkbox" id="saveChatHistory" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>إجراءات</h3>
                    <button onclick="exitChat()" class="btn btn-warning">
                        <i class="fas fa-sign-out-alt"></i>
                        الخروج من الدردشة
                    </button>
                    <button onclick="exitRoom()" class="btn btn-secondary">
                        <i class="fas fa-door-open"></i>
                        الخروج من الغرفة
                    </button>
                    <button onclick="openHelpModal()" class="btn btn-info">
                        <i class="fas fa-question-circle"></i>
                        المساعدة
                    </button>
                    <button onclick="showRanks()" class="btn btn-primary">
                        <i class="fas fa-crown"></i>
                        عرض الرتب
                    </button>
                    <button onclick="cleanRooms()" class="btn btn-danger admin-only">
                        <i class="fas fa-broom"></i>
                        تنظيف الغرف
                    </button>
                </div>
                <button onclick="saveSettings()" class="btn save-btn">
                    <i class="fas fa-save"></i>
                    حفظ الإعدادات
                </button>
            </div>
        </div>
    </div>
    <!-- مودال مشغل الراديو -->
    <div id="radioPlayerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>📻 مشغل الراديو</h2>
                <button class="close-btn" onclick="closeRadioPlayer()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="radio-content">
                <div class="radio-stations">
                    <div class="station" onclick="playRadioStation('arabic')">
                        <i class="fas fa-music"></i>
                        <span>محطة الأغاني العربية</span>
                    </div>
                    <div class="station" onclick="playRadioStation('english')">
                        <i class="fas fa-music"></i>
                        <span>محطة الأغاني الأجنبية</span>
                    </div>
                    <div class="station" onclick="playRadioStation('classical')">
                        <i class="fas fa-music"></i>
                        <span>محطة الموسيقى الكلاسيكية</span>
                    </div>
                </div>
                <div class="radio-controls">
                    <button id="radioPlayBtn" onclick="toggleRadio()">
                        <i class="fas fa-play"></i>
                    </button>
                    <input type="range" id="radioVolume" min="0" max="100" value="50">
                </div>
                <div class="custom-music">
                    <h4>أغانيك الخاصة</h4>
                    <input type="file" id="customMusicInput" accept="audio/*" multiple>
                    <button onclick="uploadCustomMusic()" class="btn">
                        <i class="fas fa-upload"></i>
                        رفع أغاني
                    </button>
                    <div id="customMusicList" class="custom-music-list">
                        <!-- سيتم ملؤها بالجافاسكريبت -->
                    </div>
                </div>
            </div>
        </div>
    </div>
            <!-- مودال إنشاء غرفة -->
            <div id="createRoomModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>إنشاء غرفة جديدة</h2>
                        <button class="close-btn" onclick="closeCreateRoomModal()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="room-form">
                        <div class="form-group">
                            <label>اسم الغرفة:</label>
                            <input type="text" id="roomName" placeholder="اسم الغرفة" required>
                        </div>
                        <div class="form-group">
                            <label>وصف الغرفة:</label>
                            <textarea id="roomDescription" placeholder="وصف الغرفة (اختياري)"></textarea>
                        </div>
                        <div class="form-group">
                            <label>خلفية الغرفة:</label>
                            <input type="file" id="roomBackgroundInput" accept="image/*">
                        </div>
                        <button onclick="createRoom()" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            إنشاء الغرفة
                        </button>
                    </div>
                </div>
            </div>
    <!-- مودال حظر المستخدم -->
    <div id="banUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>حظر المستخدم</h2>
                <button class="close-btn" onclick="closeModal('banUserModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="ban-form">
                <div class="form-group">
                    <label>المستخدم المحدد:</label>
                    <span id="banTargetUser" data-user-id=""></span>
                </div>
                <div class="form-group">
                    <label>سبب الحظر:</label>
                    <textarea id="banReason" placeholder="اكتب سبب الحظر..." required></textarea>
                </div>
                <div class="form-group">
                    <label>مدة الحظر:</label>
                    <select id="banDuration">
                        <option value="1">ساعة واحدة</option>
                        <option value="24">24 ساعة</option>
                        <option value="168">أسبوع واحد</option>
                        <option value="720">شهر واحد</option>
                        <option value="permanent">دائم</option>
                    </select>
                </div>
                <button onclick="banUser()" class="btn btn-danger">
                    <i class="fas fa-ban"></i>
                    حظر المستخدم
                </button>
            </div>
        </div>
    </div>
    <!-- مودال إهداء النقاط -->
    <div id="giveCoinsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>إهداء نقاط</h2>
                <button class="close-btn" onclick="closeModal('giveCoinsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="coins-form">
                <div class="form-group">
                    <label>المستخدم المحدد:</label>
                    <span id="coinsTargetUser" data-user-id=""></span>
                </div>
                <div class="form-group">
                    <label>عدد النقاط:</label>
                    <input type="number" id="coinsAmount" placeholder="عدد النقاط" min="1" max="10000" required>
                </div>
                <div class="form-group">
                    <label>سبب الإهداء:</label>
                    <textarea id="coinsReason" placeholder="سبب إهداء النقاط (اختياري)"></textarea>
                </div>
                <button onclick="giveCoins()" class="btn btn-primary">
                    <i class="fas fa-coins"></i>
                    إهداء النقاط
                </button>
            </div>
        </div>
    </div>
    <!-- مودال إرسال إشعار -->
    <div id="sendNotificationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>🔔 إرسال إشعار</h2>
                <button class="close-btn" onclick="closeSendNotificationModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="notification-form">
                    <div class="form-group">
                        <label>اختر المستخدم:</label>
                        <select id="notificationRecipient">
                            <option value="">اختر مستخدم...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>رسالة الإشعار:</label>
                        <textarea id="notificationMessage" placeholder="اكتب رسالة الإشعار..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>نوع الإشعار:</label>
                        <select id="notificationType">
                            <option value="info">معلومات</option>
                            <option value="success">نجاح</option>
                            <option value="warning">تحذير</option>
                            <option value="error">خطأ</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button onclick="sendNotificationToUser()" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> إرسال
                        </button>
                        <button onclick="closeSendNotificationModal()" class="btn btn-secondary">إلغاء</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- مودال إرسال إشعار -->
    <div id="sendNotificationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>📢 إرسال إشعار</h2>
                <button class="close-btn" onclick="closeSendNotificationModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="notification-form">
                    <div class="form-group">
                        <label for="notificationRecipient">اختر المستخدم:</label>
                        <select id="notificationRecipient" class="form-control">
                            <option value="">اختر مستخدم...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="notificationType">نوع الإشعار:</label>
                        <select id="notificationType" class="form-control">
                            <option value="info">معلومات</option>
                            <option value="success">نجاح</option>
                            <option value="warning">تحذير</option>
                            <option value="error">خطأ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="notificationMessage">رسالة الإشعار:</label>
                        <textarea id="notificationMessage" class="form-control" placeholder="اكتب رسالة الإشعار هنا..." rows="4"></textarea>
                    </div>
                    <div class="modal-actions">
                        <button onclick="sendNotificationToUser()" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i>
                            إرسال الإشعار
                        </button>
                        <button onclick="closeSendNotificationModal()" class="btn btn-secondary">
                            إلغاء
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- مودال المتصلين حالياً -->
    <div id="onlineUsersModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>👥 المتصلين حالياً</h2>
                <button class="close-btn" onclick="closeOnlineUsersModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="onlineUsersList" class="online-users-list">
                    <p style="text-align: center; color: var(--text-secondary);">جاري تحميل قائمة المتصلين...</p>
                </div>
            </div>
        </div>
    </div>
    <!-- صندوق الدردشة الخاصة -->
    <div id="privateChatBox" class="private-chat-box" style="display: none;">
        <div class="chat-box-header">
            <h3 class="chat-box-title">💬 دردشة خاصة</h3>
            <div class="chat-box-controls">
                <button class="chat-box-btn" onclick="minimizePrivateChatBox()" title="تصغير">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="chat-box-btn" onclick="closePrivateChatBox()" title="إغلاق">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="chat-box-body">
            <div class="private-chat-users">
                <select id="privateChatUserSelect" onchange="selectPrivateChatUser()">
                    <option value="">اختر مستخدم للدردشة...</option>
                </select>
            </div>
            <div id="privateChatMessages" class="private-chat-messages">
                <p style="text-align: center; color: var(--text-secondary); padding: 20px;">
                    اختر مستخدم لبدء المحادثة
                </p>
            </div>
            <div class="private-chat-input">
                <input type="text" id="privateChatInput" placeholder="اكتب رسالة..." onkeypress="if(event.key==='Enter') sendPrivateChatMessage()">
                <button class="private-chat-send" onclick="sendPrivateChatMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="loading-spinner" style="display: none;">
        <div class="spinner"></div>
        <p>جاري التحميل...</p>
    </div>
    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>
    <!-- Audio Elements -->
    <audio id="notificationSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp6...... (الكود الأصلي لم يتغير هنا) ......"></audio>
    <script src="/socket.io/socket.io.js"></script>
    <script src="script.js"></script>
    <!-- مودال تسجيل الدخول -->
<div id="loginModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeLoginModal()">&times;</span>
        <h2>🔐 تسجيل الدخول</h2>
        <input type="email" id="loginEmail" placeholder="البريد الإلكتروني" style="width: 100%; padding: 10px; margin: 10px 0;">
        <input type="password" id="loginPassword" placeholder="كلمة المرور" style="width: 100%; padding: 10px; margin: 10px 0;">
        <button onclick="login()" style="width: 100%; padding: 10px; background: #007bff; color: white; border: none;">دخول</button>
    </div>
</div>
<!-- مودال لوحة المالك -->
<div id="ownerModal" class="modal">
    <div class="modal-content" style="width: 90%;">
        <span class="close" onclick="closeOwnerModal()">&times;</span>
        <h2 style="color: #ff1493;">🏆 لوحة تحكم المالك</h2>
        <div id="ownerContent">
            <!-- سيتم ملء المحتوى هنا -->
        </div>
    </div>
</div>
<script>
// ===== الكود البسيط للرتب =====
let currentUser = null;
// فتح مودال تسجيل الدخول
function showLoginModal() {
    document.getElementById('loginModal').style.display = 'block';
}
// إغلاق مودال تسجيل الدخول
function closeLoginModal() {
    document.getElementById('loginModal').style.display = 'none';
}
    /**
     * هذا الكود يدمج منطق معالجة تسجيل الدخول المتقدم (API، التحقق من الحظر، حالة التحميل)
     * مع بيانات اعتماد المالك المخصصة الجديدة والمعلومات الجديدة.
     * يجب أن تكون الدوال المساعدة مثل showError, showLoading, showMainScreen, إلخ. معرفة في الكود العام ليعمل بشكل سليم.
     */
    async function handleLogin(e) {
        // منع السلوك الافتراضي لإرسال الفورم إذا تم استدعاء الدالة بواسطة حدث فور
        if (e && e.preventDefault) {
            e.preventDefault();
        }

        // تعريف بيانات الاعتماد الجديدة للمالك كما هو مطلوب
        const OWNER_EMAIL_NEW = 'njdj9985@gmail.com';
        const OWNER_PASSWORD_NEW = 'Zxcvbnm.8'; // تأكد من أن هذه البيانات سرية ولا تُعرض في كود الواجهة الأمامية (Frontend) في بيئة إنتاجية

        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value;

        // التحقق من أن جميع الحقول مملوءة
        if (!email || !password) {
            // يجب أن تكون دالة showError موجودة
            showError('يرجى ملء جميع الحقول');
            return;
        }

        try {
            // يجب أن تكون دالة showLoading موجودة
            showLoading(true);

            // ===================================
            // التحقق من المالك (بيانات الاعتماد الجديدة)
            // ===================================
            if (email === OWNER_EMAIL_NEW && password === OWNER_PASSWORD_NEW) {

                // تعريف كائن المستخدم للمالك بالبيانات الجديدة المطلوبة
                const ownerUser = {
                    id: 1,
                    username: 'مالك الشات',
                    email: njdj9985@gmail.com,
                    isOwner: true,
                    role: 'owner',
                    rank: 'مالك الموقع🏆', // تم استخدام هذا الحقل للتوافق مع الكود الأصلي
                    rankInfo: { name: '🏆 مالك النظام', emoji: '🏆', color: '#ff1493' },
                    coins: 999999999, // تم الاحتفاظ بها للتوافق
                    level: 10, // تم الاحتفاظ بها للتوافق
                    profile_image1: null,
                    created_at: new Date().toISOString()
                };

                // حفظ بيانات المالك في التخزين المحلي
                localStorage.setItem('chatToken', 'owner-token-' + Date.now()); // استخدام توكين وهمي للمالك
                localStorage.setItem('isOwner', 'true');
                localStorage.setItem('userData', JSON.stringify(ownerUser)); // حفظ بيانات المالك الجديدة

                // تحديث حالة التطبيق
                currentUser = ownerUser; // يجب تعريف currentUser كمتغير عام
                isOwner = true; // يجب تعريف isOwner كمتغير عام

                // تنفيذ الإجراءات المطلوبة عند تسجيل دخول المالك
                closeLoginModal(); // يجب أن تكون الدالة موجودة
                showOwnerModal();  // يجب أن تكون الدالة موجودة
                updateNavbar();    // يجب أن تكون الدالة موجودة

                showMainScreen();      // يجب أن تكون الدالة موجودة
                initializeSocket();    // يجب أن تكون الدالة موجودة

                // إظهار تنبيه المالك المطلوب (تم دمجها مع التنبيه الأصلي لمزيد من المعلومات)
                alert('🎉 مرحباً يا مالك! 🏆'); 
                showNotification('مرحباً مالك الموقع! لديك صلاحيات كاملة', 'success'); // يجب أن تكون الدالة موجودة
                return;
            }

            // ===================================
            // تسجيل دخول عادي (عبر الـ API)
            // ===================================
            const response = await fetch('/api/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email, password })
            });

            const data = await response.json();

            if (response.ok) {
                localStorage.setItem('chatToken', data.token);
                currentUser = data.user;

                // حفظ بيانات المستخدم العادي لضمان التوافق مع منطق المالك
                localStorage.setItem('userData', JSON.stringify(data.user)); 

                // تحديث المتغيرات العامة (افتراضاً)
                userCoins = data.user.coins || 2000;
                userLevel = data.user.level || 1;

                // التحقق من الحظر
                if (currentUser.isBanned) {
                    // يجب أن تكون دالة showBanScreen موجودة
                    showBanScreen(currentUser.banReason || 'تم حظرك من الموقع');
                    return;
                }

                // الإجراءات النهائية لتسجيل الدخول الناجح
                closeLoginModal(); // إغلاق المودال
                showMainScreen();
                initializeSocket();
                loadUserPrivacySettings(); // يجب أن تكون الدالة موجودة
                showNotification('تم تسجيل الدخول بنجاح', 'success');
            } else {
                // إظهار خطأ تسجيل الدخول عبر API
                showError(data.error || 'بيانات تسجيل الدخول غير صحيحة');
                alert('❌ بيانات خاطئة'); // إضافة التنبيه المطلوب هنا أيضاً
            }
        } catch (error) {
            console.error('خطأ في تسجيل الدخول:', error);
            showError('حدث خطأ في الاتصال بالخادم');
        } finally {
            // إخفاء حالة التحميل دائماً
            showLoading(false);
        }
    }
// فتح لوحة المالك
function showOwnerModal() {
    if (!currentUser || !currentUser.isOwner) {
        alert('🚫 ليس لديك صلاحية');
        return;
    }
    document.getElementById('ownerModal').style.display = 'block';
    loadOwnerPanel();
}
// إغلاق لوحة المالك
function closeOwnerModal() {
    document.getElementById('ownerModal').style.display = 'none';
}
// تحميل لوحة المالك
function loadOwnerPanel() {
    document.getElementById('ownerContent').innerHTML = `
        <h3>👑 أهلاً بك يا مالك!</h3>
        <p>لديك التحكم الكامل في النظام</p>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
            <button onclick="manageUsers()" style="padding: 15px; background: #ff1493; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 16px;">
                👥 إدارة المستخدمين
            </button>
            <button onclick="manageRanks()" style="padding: 15px; background: #007bff; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 16px;">
                🏷️ إدارة الرتب
            </button>
            <button onclick="systemSettings()" style="padding: 15px; background: #28a745; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 16px;">
                ⚙️ إعدادات النظام
            </button>
        </div>
        <h4>قائمة المستخدمين:</h4>
        <div id="usersList"></div>
    `;
    showUsersList();
}
// عرض قائمة المستخدمين
function showUsersList() {
    const usersList = document.getElementById('usersList');
    const demoUsers = [
        { id: 2, username: 'أحمد', rank: 'vip', email: 'ahmed@test.com' },
        { id: 3, username: 'فاطمة', rank: 'gold', email: 'fatima@test.com' },
        { id: 4, username: 'زائر', rank: 'visitor', email: 'visitor@test.com' }
    ];
    usersList.innerHTML = demoUsers.map(user => `
        <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 10px; background: #f9f9f9;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <strong>${user.username}</strong> 
                    <span class="rank-badge" style="background: ${user.rank === 'vip' ? '#ffc107' : user.rank === 'gold' ? '#ffd700' : '#6c757d'}; color: white; padding: 2px 6px; border-radius: 10px;">
                        ${user.rank}
                    </span>
                    <br><small>${user.email}</small>
                </div>
                <div>
                    <button onclick="changeRank(${user.id}, '${user.username}')" style="padding: 5px 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 2px;">
                        تغيير رتبة
                    </button>
                    <button onclick="removeRank(${user.id}, '${user.username}')" style="padding: 5px 10px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 2px;">
                        إزالة رتبة
                    </button>
                </div>
            </div>
        </div>
    `).join('');
}
    // تعريف المالك
    const OWNER_EMAIL = "njdj9985@mail.com"; // غيّرها لإيميلك الحقيقي

    // تغيير رتبة
    function changeRank(userId, username) {
        const currentUserEmail = localStorage.getItem('userEmail');

        // فقط المالك يستطيع تغيير الرتب
        if (currentUserEmail !== OWNER_EMAIL) {
            alert('❌ لا يمكنك تغيير الرتب — فقط المالك يستطيع ذلك');
            return;
        }

        const newRank = prompt(`ما هي الرتبة الجديدة لـ ${username}؟ (vip, gold, silver, bronze, member, visitor)`);
        if (newRank && ['vip', 'gold', 'silver', 'bronze', 'member', 'visitor'].includes(newRank)) {
            alert(`✅ تم تغيير رتبة ${username} إلى ${newRank}`);
            // هنا تضيف الكود لتغيير الرتبة في الـ Backend
            showUsersList(); // تحديث القائمة
        } else {
            alert('❌ رتبة غير صالحة');
        }
    }

    // إزالة رتبة
    function removeRank(userId, username) {
        const currentUserEmail = localStorage.getItem('userEmail');

        // فقط المالك يستطيع إزالة الرتب
        if (currentUserEmail !== OWNER_EMAIL) {
            alert('❌ لا يمكنك إزالة الرتب — فقط المالك يستطيع ذلك');
            return;
        }

        if (confirm(`هل أنت متأكد من إزالة رتبة ${username}؟`)) {
            alert(`✅ تم إزالة رتبة ${username}`);
            // هنا تضيف الكود لإزالة الرتبة في الـ Backend
            showUsersList(); // تحديث القائمة
        }
    }

// تحديث شريط التنقل
function updateNavbar() {
    const navbar = document.querySelector('nav, .header, .navbar');
    if (navbar && currentUser) {
        const userInfo = navbar.querySelector('.user-info, .profile');
        if (userInfo) {
            userInfo.innerHTML = `
                <span style="color: ${currentUser.rankInfo.color}; font-weight: bold;">
                    ${currentUser.rankInfo.emoji} ${currentUser.username}
                </span>
                ${currentUser.isOwner ? '<button onclick="showOwnerModal()" style="margin-right: 10px; padding: 5px 10px; background: #ff1493; color: white; border: none; border-radius: 15px; cursor: pointer;">👑 لوحة التحكم</button>' : ''}
            `;
        }
    }
}
// إعدادات النظام
function systemSettings() {
    document.getElementById('ownerContent').innerHTML = `
        <h3>⚙️ إعدادات النظام</h3>
        <p>هنا يمكنك التحكم في إعدادات الشات</p>
        <div style="display: flex; flex-direction: column; gap: 10px;">
            <label><input type="checkbox" checked> الإشعارات</label>
            <label><input type="checkbox" checked> رفع الملفات</label>
            <label><input type="checkbox" checked> ردود الفعل</label>
            <button onclick="saveSettings()" style="padding: 10px; background: #28a745; color: white; border: none; border-radius: 10px;">حفظ</button>
        </div>
    `;
}
function saveSettings() {
    alert('✅ تم حفظ الإعدادات');
}
// إدارة المستخدمين
function manageUsers() {
    document.getElementById('ownerContent').innerHTML = `
        <h3>👥 إدارة المستخدمين</h3>
        <p>قائمة كاملة بالمستخدمين</p>
        <div id="usersList"></div>
    `;
    showUsersList();
}
// إدارة الرتب
function manageRanks() {
    document.getElementById('ownerContent').innerHTML = `
        <h3>🏷️ إدارة الرتب</h3>
        <p>قائمة الرتب المتاحة:</p>
        <ul>
            <li>VIP ⭐</li>
            <li>Gold 🥇</li>
            <li>Silver 🥈</li>
            <li>Bronze 🥉</li>
            <li>Member 👤</li>
            <li>Visitor 👋</li>
        </ul>
    `;
}
// حفظ الإعدادات
function saveSettings() {
    alert('تم حفظ الإعدادات بنجاح!');
}
// التحقق من الجلسة عند تحميل الصفحة
if (localStorage.getItem('userData')) {
    try {
        currentUser = JSON.parse(localStorage.getItem('userData'));
        if (currentUser.isOwner) {
            updateNavbar();
        }
    } catch (e) {
        console.log('جلسة منتهية');
    }
}
// إضافة زر تسجيل الدخول في القائمة
document.addEventListener('DOMContentLoaded', function() {
    const menu = document.querySelector('.main-menu, nav, .navbar');
    if (menu && !menu.querySelector('#loginBtn')) {
        const loginBtn = document.createElement('button');
        loginBtn.id = 'loginBtn';
        loginBtn.innerHTML = '🔐 دخول';
        loginBtn.style.cssText = 'padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 10px; cursor: pointer;';
        loginBtn.onclick = showLoginModal;
        // إضافة الزر في القائمة
        const firstBtn = menu.querySelector('button');
        if (firstBtn) {
            firstBtn.parentNode.insertBefore(loginBtn, firstBtn);
        } else {
            menu.appendChild(loginBtn);
        }
    }
});

// ⬇⬇⬇ الدالة الجديدة التي طلبتها ⬇⬇⬇
function openAppStore() {
    alert('جارٍ فتح متجر التطبيق...');
    // سيتم استبدال هذا لاحقاً بكود المتجر الحقيقي
}
// ⬆⬆⬆ نهاية الدالة الجديدة ⬆⬆⬆
<!-- Footer - يظهر للجميع -->
<footer class="site-footer">
    <div class="footer-content">
        <p> شات رعووود الحياه &copy; 2026 | منصة التواصل الاجتماعي الأولى</p>
        <!-- يمكن إضافة روابط أو معلومات أخرى هنا -->

    /* Enhanced style.css مع نظام الإطارات المُصحح */

/* ===== متجر التطبيق ===== */
.app-store-modal {
    max-width: 1200px;
    width: 95%;
    max-height: 90vh;
    overflow-y: auto;
}

.store-content {
    padding: 20px;
}

.store-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    color: white;
}

.user-coins {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 1.2em;
    font-weight: bold;
}

.user-coins i {
    color: #ffd700;
    font-size: 1.4em;
}

.store-tabs {
    display: flex;
    gap: 10px;
}

.store-tab {
    padding: 12px 20px;
    background: rgba(255, 255, 255, 0.2);
    border: none;
    border-radius: 10px;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.store-tab:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
}

.store-tab.active {
    background: rgba(255, 255, 255, 0.9);
    color: #333;
}

.store-tab-content {
    min-height: 400px;
}

/* ===== الإطارات ===== */
.frames-container {
    margin-top: 20px;
}

.frame-category {
    margin-bottom: 40px;
}

.category-title {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
    padding: 15px 20px;
    border-radius: 12px;
    font-size: 1.3em;
    font-weight: bold;
}

.owner-title {
    background: linear-gradient(135deg, #ff1493, #ff69b4);
    color: white;
}

.admin-title {
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    color: #333;
}

.prince-title {
    background: linear-gradient(135deg, #9370db, #ba55d3);
    color: white;
}

.frames-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
    padding: 10px;
}

/* ===== بطاقات الإطارات ===== */
.frame-card {
    background: white;
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    overflow: hidden;
    position: relative;
}

.frame-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.frame-card.owner {
    border: 2px solid #ff1493;
    background: linear-gradient(135deg, #fff 0%, #ffe4f1 100%);
}

.frame-card.admin {
    border: 2px solid #ffd700;
    background: linear-gradient(135deg, #fff 0%, #fffacd 100%);
}

.frame-card.prince {
    border: 2px solid #9370db;
    background: linear-gradient(135deg, #fff 0%, #f0e6ff 100%);
}

.frame-preview {
    position: relative;
    text-align: center;
    margin-bottom: 15px;
}

.frame-image {
    position: relative;
    display: inline-block;
    border-radius: 50%;
    padding: 5px;
    background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
}

.owner-frame {
    background: linear-gradient(45deg, #ff1493, #ff69b4, #ff1493);
}

.admin-frame {
    background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
}

.prince-frame {
    background: linear-gradient(45deg, #9370db, #ba55d3, #9370db);
}

.sample-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    overflow: hidden;
    position: relative;
    z-index: 2;
}

.sample-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.frame-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: 50%;
    pointer-events: none;
}

.frame-overlay.owner {
    background: radial-gradient(circle, transparent 70%, rgba(255, 20, 147, 0.3) 100%);
}

.frame-overlay.admin {
    background: radial-gradient(circle, transparent 70%, rgba(255, 215, 0, 0.3) 100%);
}

.frame-overlay.prince {
    background: radial-gradient(circle, transparent 70%, rgba(147, 112, 219, 0.3) 100%);
}

.frame-info {
    text-align: center;
}

.frame-name {
    font-size: 1.1em;
    font-weight: bold;
    margin: 10px 0;
    color: #333;
}

.frame-rarity {
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.9em;
    font-weight: bold;
    margin: 10px 0;
    display: inline-block;
}

.frame-rarity.owner {
    background: linear-gradient(135deg, #ff1493, #ff69b4);
    color: white;
}

.frame-rarity.admin {
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    color: #333;
}

.frame-rarity.prince {
    background: linear-gradient(135deg, #9370db, #ba55d3);
    color: white;
}

.frame-price {
    font-size: 1.1em;
    font-weight: bold;
    color: #2c3e50;
    margin: 10px 0;
}

.frame-price i {
    color: #ffd700;
    margin-right: 5px;
}

.exclusive-tag {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    color: white;
    padding: 4px 12px;
    border-radius: 15px;
    font-size: 0.9em;
}

.frame-actions {
    margin-top: 15px;
}

/* ===== أزرار الإجراءات ===== */
.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    justify-content: center;
}

.btn-success {
    background: linear-gradient(135deg, #27ae60, #2ecc71);
    color: white;
}

.btn-success:hover {
    background: linear-gradient(135deg, #229954, #27ae60);
    transform: translateY(-2px);
}

.btn-primary {
    background: linear-gradient(135deg, #3498db, #2980b9);
    color: white;
}

.btn-primary:hover {
    background: linear-gradient(135deg, #2980b9, #21618c);
    transform: translateY(-2px);
}

.btn-active {
    background: linear-gradient(135deg, #f39c12, #e67e22);
    color: white;
}

.btn-disabled {
    background: #bdc3c7;
    color: #7f8c8d;
    cursor: not-allowed;
}

.btn-disabled:hover {
    transform: none;
}

/* ===== الرسوم المتحركة للإطارات ===== */
@keyframes owner-glow {
    0% {
        box-shadow: 0 0 10px rgba(255, 20, 147, 0.5);
        filter: brightness(1);
    }
    100% {
        box-shadow: 0 0 25px rgba(255, 20, 147, 0.8), 0 0 35px rgba(255, 20, 147, 0.4);
        filter: brightness(1.2);
    }
}

@keyframes admin-shine {
    0% {
        box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        transform: rotate(0deg);
    }
    100% {
        box-shadow: 0 0 25px rgba(255, 215, 0, 0.8), 0 0 35px rgba(255, 215, 0, 0.4);
        transform: rotate(5deg);
    }
}

@keyframes prince-sparkle {
    0% {
        box-shadow: 0 0 10px rgba(147, 112, 219, 0.5);
        filter: saturate(1);
    }
    100% {
        box-shadow: 0 0 25px rgba(147, 112, 219, 0.8), 0 0 35px rgba(147, 112, 219, 0.4);
        filter: saturate(1.3);
    }
}

@keyframes golden-glow {
    0% { 
        box-shadow: 0 0 5px #ffd700; 
        transform: scale(1);
    }
    100% { 
        box-shadow: 0 0 20px #ffd700, 0 0 30px #ffd700; 
        transform: scale(1.02);
    }
}

@keyframes royal-pulse {
    0% { 
        transform: scale(1);
        opacity: 1;
    }
    50% { 
        transform: scale(1.05);
        opacity: 0.8;
    }
    100% { 
        transform: scale(1);
        opacity: 1;
    }
}

@keyframes dragon-fire {
    0% { 
        filter: hue-rotate(0deg) saturate(1);
        transform: rotate(0deg);
    }
    25% { 
        filter: hue-rotate(90deg) saturate(1.2);
    }
    50% { 
        filter: hue-rotate(180deg) saturate(1.4);
        transform: rotate(2deg);
    }
    75% { 
        filter: hue-rotate(270deg) saturate(1.2);
    }
    100% { 
        filter: hue-rotate(360deg) saturate(1);
        transform: rotate(0deg);
    }
}

/* ===== مؤشر التفعيل ===== */
.active-indicator {
    position: absolute;
    top: -5px;
    right: -5px;
    background: linear-gradient(135deg, #27ae60, #2ecc71);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.8em;
    font-weight: bold;
    z-index: 10;
    animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

/* ===== قسم المشتريات ===== */
.my-items-empty {
    text-align: center;
    padding: 60px 20px;
    color: #7f8c8d;
}

.my-items-empty i {
    font-size: 4em;
    margin-bottom: 20px;
    opacity: 0.5;
}

.my-items-container h3 {
    margin-bottom: 30px;
    color: #2c3e50;
    text-align: center;
}

.frame-card.owned {
    position: relative;
}

.frame-card.owned::before {
    content: "مملوك";
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(39, 174, 96, 0.9);
    color: white;
    padding: 4px 8px;
    border-radius: 8px;
    font-size: 0.8em;
    font-weight: bold;
    z-index: 5;
}

/* ===== قسم قيد التطوير ===== */
.coming-soon {
    text-align: center;
    padding: 60px 20px;
    color: #7f8c8d;
}

.coming-soon i {
    font-size: 3em;
    margin-bottom: 20px;
    color: #bdc3c7;
}

.decorations-container {
    text-align: center;
    padding: 40px 20px;
}

/* ===== رسائل التنبيه ===== */
.toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.toast {
    padding: 15px 20px;
    border-radius: 8px;
    color: white;
    font-weight: bold;
    min-width: 300px;
    animation: slideIn 0.3s ease-out, fadeOut 0.3s ease-out 2.7s;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.toast-success {
    background: linear-gradient(135deg, #27ae60, #2ecc71);
}

.toast-error {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
}

.toast-info {
    background: linear-gradient(135deg, #3498db, #2980b9);
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes fadeOut {
    from {
        opacity: 1;
    }
    to {
        opacity: 0;
        transform: translateX(100%);
    }
}

/* ===== إطارات الرسائل في الشات ===== */
.frame-owner img,
.frame-owner .user-avatar-mini {
    border: 3px solid #ff1493 !important;
    animation: owner-glow 2s ease-in-out infinite alternate;
}

.frame-admin img,
.frame-admin .user-avatar-mini {
    border: 3px solid #ffd700 !important;
    animation: admin-shine 1.5s ease-in-out infinite alternate;
}

.frame-prince img,
.frame-prince .user-avatar-mini {
    border: 3px solid #9370db !important;
    animation: prince-sparkle 2s ease-in-out infinite alternate;
}

/* ===== تحسينات الرسوم المتحركة ===== */
.animated-frame[data-animation="golden-glow"] {
    animation: golden-glow 2s ease-in-out infinite alternate;
}

.animated-frame[data-animation="royal-pulse"] {
    animation: royal-pulse 1.5s ease-in-out infinite;
}

.animated-frame[data-animation="dragon-fire"] {
    animation: dragon-fire 3s linear infinite;
}

.animated-frame[data-animation="silver-shine"] {
    animation: admin-shine 1.5s ease-in-out infinite alternate;
}

.animated-frame[data-animation="power-glow"] {
    animation: power-glow 1.8s ease-in-out infinite;
}

.animated-frame[data-animation="prince-gold"] {
    animation: prince-sparkle 2s ease-in-out infinite alternate;
}

@keyframes power-glow {
    0% {
        box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
    }
    50% {
        box-shadow: 0 0 20px rgba(0, 123, 255, 0.8), 0 0 30px rgba(0, 123, 255, 0.3);
    }
    100% {
        box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
    }
}
    <!-- مودال متجر التطبيق مع نظام الإطارات -->
    <div id="appStoreModal" class="modal">
        <div class="modal-content app-store-modal">
            <div class="modal-header">
                <h2>🏪 متجر التطبيق</h2>
                <button class="close-btn" onclick="closeAppStore()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="store-header">
                <div class="user-coins">
                    <i class="fas fa-coins"></i>
                    <span id="userCoinsDisplay">2000</span>
                    <span>نقطة</span>
                </div>

                <div class="store-tabs">
                    <button class="store-tab active" onclick="switchStoreTab('frames')">
                        <i class="fas fa-crown"></i> الإطارات
                    </button>
                    <button class="store-tab" onclick="switchStoreTab('gifts')">
                        <i class="fas fa-gift"></i> الهدايا
                    </button>
                    <button class="store-tab" onclick="switchStoreTab('decorations')">
                        <i class="fas fa-palette"></i> الزخارف
                    </button>
                    <button class="store-tab" onclick="switchStoreTab('myItems')">
                        <i class="fas fa-shopping-bag"></i> مشترياتي
                    </button>
                </div>
            </div>

            <!-- تبويب الإطارات -->
            <div id="storeFramesTab" class="store-tab-content active">
                <!-- إطارات المالك -->
                <div class="frame-category">
                    <h3 class="category-title owner-title">
                        <i class="fas fa-dragon"></i> إطارات المالك
                    </h3>
                    <div class="frames-grid" id="ownerFramesGrid">
                        <!-- سيتم ملؤها بالجافاسكريبت -->
                    </div>
                </div>
        <!-- إطارات أسطورية - NEW -->
        <div class="frame-category">
            <h3 class="category-title legendary-title">
                <i class="fas fa-star"></i> إطارات أسطورية
            </h3>
            <div class="frames-grid" id="legendaryFramesGrid">
                <!-- سيتم ملؤها بالجافاسكريبت -->
            </div>
        </div>
                <!-- إطارات الإدارة -->
                <div class="frame-category">
                    <h3 class="category-title admin-title">
                        <i class="fas fa-shield-alt"></i> إطارات الإدارة
                    </h3>
                    <div class="frames-grid" id="adminFramesGrid">
                        <!-- سيتم ملؤها بالجافاسكريبت -->
                    </div>
                </div>

                <!-- إطارات البرنس -->
                <div class="frame-category">
                    <h3 class="category-title prince-title">
                        <i class="fas fa-gem"></i> إطارات البرنس
                    </h3>
                    <div class="frames-grid" id="princeFramesGrid">
                        <!-- سيتم ملؤها بالجافاسكريبت -->
                    </div>
                </div>
            </div>

            <!-- تبويب الهدايا -->
            <div id="storeGiftsTab" class="store-tab-content">
                <div class="coming-soon">
                    <i class="fas fa-gift"></i>
                    <h3>قريباً...</h3>
                    <p>نظام الهدايا قيد التطوير</p>
                </div>
            </div>

            <!-- تبويب الزخارف -->
            <div id="storeDecorationsTab" class="store-tab-content">
                <div class="coming-soon">
                    <i class="fas fa-palette"></i>
                    <h3>قريباً...</h3>
                    <p>زخارف الأسماء قيد التطوير</p>
                </div>
            </div>

            <!-- تبويب مشترياتي -->
            <div id="storeMyItemsTab" class="store-tab-content">
                <div class="my-items-container">
                    <h3>إطاراتي المملوكة</h3>
                    <div class="frames-grid" id="myFramesGrid">
                        <!-- سيتم ملؤها بالجافاسكريبت -->
                    </div>
                </div>
            </div>
        </div>
    </div>

/* ===== استجابة للأجهزة المحمولة ===== */
@media (max-width: 768px) {
    .frames-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 15px;
    }
    
    .store-header {
        flex-direction: column;
        gap: 20px;
        text-align: center;
    }
    
    .store-tabs {
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .app-store-modal {
        width: 98%;
        max-height: 95vh;
    }
    
    .toast {
        min-width: 250px;
    }
    
    .toast-container {
        right: 10px;
        left: 10px;
    }
}

@media (max-width: 480px) {
    .frames-grid {
        grid-template-columns: 1fr;
    }
    
    .store-tab {
        padding: 8px 16px;
        font-size: 0.9em;
    }
    
    .frame-card {
        padding: 15px;
    }
}
    </div>
<!-- Footer - يظهر للجميع -->
<footer class="site-footer">
    <div class="footer-content">
        <p> شات رعووود الحياه&copy; 2026 | منصة التواصل الاجتماعي الأولى</p>
    </div>
</footer>

<script src="/socket.io/socket.io.js"></script>
<script src="script.js"></script>
    <!-- مودال متجر التطبيق مع نظام الإطارات -->

            <!-- مودال متجر التطبيق مع نظام الإطارات المتحركة الفخمة -->
            <div id="appStoreModal" class="modal">
                <div class="modal-content app-store-modal">
                    <div class="modal-header">
                        <h2>🏪 متجر التطبيق</h2>
                        <button class="close-btn" onclick="closeAppStore()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="store-header">
                        <div class="user-coins">
                            <i class="fas fa-coins"></i>
                            <span id="userCoinsDisplay">2000</span>
                            <span>نقطة</span>
                        </div>

                        <div class="store-tabs">
                            <button class="store-tab active" onclick="switchStoreTab('frames')">
                                <i class="fas fa-crown"></i> الإطارات
                            </button>
                            <button class="store-tab" onclick="switchStoreTab('gifts')">
                                <i class="fas fa-gift"></i> الهدايا
                            </button>
                            <button class="store-tab" onclick="switchStoreTab('decorations')">
                                <i class="fas fa-palette"></i> الزخارف
                            </button>
                            <button class="store-tab" onclick="switchStoreTab('myItems')">
                                <i class="fas fa-shopping-bag"></i> مشترياتي
                            </button>
                        </div>
                    </div>

                    <!-- تبويب الإطارات -->
                    <div id="storeFramesTab" class="store-tab-content active">
                        <!-- إطارات المالك -->
                        <div class="frame-category">
                            <h3 class="category-title owner-title">
                                <i class="fas fa-dragon"></i> إطارات المالك الحصرية
                            </h3>
                            <div class="frames-grid" id="ownerFramesGrid">
                                <!-- سيتم ملؤها بالجافاسكريبت -->
                            </div>
                        </div>

                        <!-- إطارات الإدارة -->
                        <div class="frame-category">
                            <h3 class="category-title admin-title">
                                <i class="fas fa-shield-alt"></i> إطارات الإدارة
                            </h3>
                            <div class="frames-grid" id="adminFramesGrid">
                                <!-- سيتم ملؤها بالجافاسكريبت -->
                            </div>
                        </div>

                        <!-- إطارات البرنس -->
                        <div class="frame-category">
                            <h3 class="category-title prince-title">
                                <i class="fas fa-gem"></i> إطارات البرنس
                            </h3>
                            <div class="frames-grid" id="princeFramesGrid">
                                <!-- سيتم ملؤها بالجافاسكريبت -->
                            </div>
                        </div>

                        <!-- إطارات أسطورية -->
                        <div class="frame-category">
                            <h3 class="category-title owner-title">
                                <i class="fas fa-trophy"></i> إطارات أسطورية
                            </h3>
                            <div class="frames-grid" id="legendaryFramesGrid">
                                <!-- سيتم ملؤها بالجافاسكريبت -->
                            </div>
                        </div>
                    </div>

                    <!-- تبويب الهدايا -->
                    <div id="storeGiftsTab" class="store-tab-content">
                        <div class="coming-soon">
                            <i class="fas fa-gift"></i>
                            <h3>قريباً...</h3>
                            <p>نظام الهدايا قيد التطوير</p>
                        </div>
                    </div>

                    <!-- تبويب الزخارف -->
                    <div id="storeDecorationsTab" class="store-tab-content">
                        <div class="coming-soon">
                            <i class="fas fa-palette"></i>
                            <h3>قريباً...</h3>
                            <p>زخارف الأسماء قيد التطوير</p>
                        </div>
                    </div>

                    <!-- تبويب مشترياتي -->
                    <div id="storeMyItemsTab" class="store-tab-content">
                        <div class="my-items-container">
                            <h3 style="color: white; text-align: center; margin-bottom: 30px; font-size: 24px;">
                                <i class="fas fa-shopping-bag"></i> إطاراتي المملوكة
                            </h3>
                            <div class="frames-grid" id="myFramesGrid">
                                <!-- سيتم ملؤها بالجافاسكريبت -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
</body>
</html>
